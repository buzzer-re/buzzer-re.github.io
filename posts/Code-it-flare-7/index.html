<!DOCTYPE html>









<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en"
  
    data-mode="dark"
  
>

  <!-- The Head -->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  >

  
    

    
  

  

  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="The Flare 7th AutoIT challenge" />
<meta property="og:locale" content="en" />
<meta name="description" content="The 7th challenge of Flare-On CTF, give to us a QR code generator software that are fully obfuscated, the fun part of this challenge was interpret, analyse and deobfuscate core components of the software and then, make it give us the flag." />
<meta property="og:description" content="The 7th challenge of Flare-On CTF, give to us a QR code generator software that are fully obfuscated, the fun part of this challenge was interpret, analyse and deobfuscate core components of the software and then, make it give us the flag." />
<link rel="canonical" href="https://reversing.codes/posts/Code-it-flare-7/" />
<meta property="og:url" content="https://reversing.codes/posts/Code-it-flare-7/" />
<meta property="og:site_name" content="Reversing codes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-10-23T20:23:36-03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="The Flare 7th AutoIT challenge" />
<meta name="twitter:site" content="@buzz3r_" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2020-10-23T20:23:36-03:00","datePublished":"2020-10-23T20:23:36-03:00","description":"The 7th challenge of Flare-On CTF, give to us a QR code generator software that are fully obfuscated, the fun part of this challenge was interpret, analyse and deobfuscate core components of the software and then, make it give us the flag.","headline":"The Flare 7th AutoIT challenge","mainEntityOfPage":{"@type":"WebPage","@id":"https://reversing.codes/posts/Code-it-flare-7/"},"url":"https://reversing.codes/posts/Code-it-flare-7/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>The Flare 7th AutoIT challenge | Reversing codes
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Reversing codes">
<meta name="application-name" content="Reversing codes">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/style.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js"></script>

  
</head>


  <body data-topbar-visible="true">

    <!--
  The Side Bar
-->
<style>
  body {
      text-align: justify;
  }
  </style>
  
<div id="sidebar" class="d-flex flex-column align-items-end">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" class="mx-auto">
        
          
          <img src="https://avatars.githubusercontent.com/u/22428720" alt="avatar" onerror="this.style.display='none'">
        
      </a>
    </div>

    <div class="site-title">
      <a href="/">Buzzer's blog</a>
    </div>
    <div class="site-subtitle font-italic">Security Researcher & Dreamer</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">

    

    
      

      
      <a href="https://github.com/buzzer-re" aria-label="github"
        
        
          
          target="_blank"
        

        

        rel="noopener">
        <i class="fab fa-github"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/buzz3r_" aria-label="twitter"
        
        
          
          target="_blank"
        

        

        rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        
        

        

        >
        <i class="fas fa-rss"></i>
      </a>
      

    

  </div> <!-- .sidebar-bottom -->

      <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-V8QSGFHYFB"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        id = 'G-V8QSGFHYFB'
        gtag('config', id);
    </script>
</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper">
  <div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4">
    <span id="breadcrumb">

    

    

      

        
          <span>
            <a href="/">
              Home
            </a>
          </span>

        

      

        

      

        

          
            <span>The Flare 7th AutoIT challenge</span>
          

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div id="main" class="container pl-xl-4 pr-xl-4">
        





<div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4">
    <div class="post pl-1 pr-1 pl-md-2 pr-md-2">

    

    
      
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->


<!-- images -->




  
  

  <!-- CDN URL -->
  

  <!-- Add image path -->
  

  
    
      
      
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  

  



<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    

    

  

  
  

  

  
  

  




<!-- return -->

<h1 data-toc-skip>The Flare 7th AutoIT challenge</h1>

<div class="post-meta text-muted">
    <!-- published date -->
    <span>
      Posted
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class=""
    data-ts="1603495416"
    data-df="ll"
    data-toggle="tooltip" data-placement="bottom">
  Oct 23, 2020
</em>

    </span>

    <!-- lastmod date -->
    

  

  <div class="d-flex justify-content-between">
    <!-- author(s) -->
    <span>
      

      By

      <em>
      
        <a href="https://github.com/buzzer-re">Buzzer</a>
      
      </em>
    </span>

    <div>
      <!-- page views -->
      

      <!-- read time -->
      <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="2800 words">
  <em>15 min</em> read</span>

    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <p>The 7th challenge of Flare-On CTF, give to us a QR code generator software that are fully obfuscated, the fun part of this challenge was interpret, analyse and deobfuscate core components of the software and then, make it give us the flag.</p>

<h1 id="why-this-is-useful-">Why this is useful ?</h1>

<h2 id="obfuscated-script"><span class="mr-2">Obfuscated script</span><a href="#obfuscated-script" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>In a real world scenario, malware using scripting language often came obfuscated and using a known languange, this challenge has a AutoIT software that are compressed and obfuscated, what makes the normal script analysis even harder.</p>

<h2 id="encryption-functions-and-win32-calls"><span class="mr-2">Encryption functions and Win32 calls</span><a href="#encryption-functions-and-win32-calls" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>This challenge also explores how software often use Win32 functions by creating structs from the scripting interface, this can increase the power of the script engine even more. In this one, almost all Win32 api calls are from the WinCrypto, this shows to us how can some obfuscated malware can use the encryption functions from Windows for bad porpuse.</p>

<h2 id="some-kind-of-steganography"><span class="mr-2">Some kind of steganography</span><a href="#some-kind-of-steganography" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>This challenge also explores how can we hide messages in images like Bitmap using the <a href="http://www.eiron.net/thesis">LSB</a> technique, with that the malware can literally have passwords or hidden commands in plain sight that are decoded in runtime.</p>

<h2 id="ctf"><span class="mr-2">CTF</span><a href="#ctf" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Check out, how this all behave:</p>

<p>Message:</p>

<p><strong><em>Reverse engineer this little compiled script to figure out what you need to do to make it give you the flag (as a QR code).</em></strong></p>

<p>So, in this challenge we must understand how this QR code generator works and be able to make it replace the content with the flag.</p>

<h1 id="recon">Recon</h1>

<p>Before I even started this challenge, by the name Code<strong><em>it</em></strong> I imagined that has something to do with <a href="https://www.autoitscript.com/site/">AutoIT</a>, and guess so ? It has everything to do with AutoIT.</p>

<p>The file itself is compressed with UPX</p>

<blockquote>
  <p>file codeit.exe                                   <br />
codeit.exe: PE32 executable (GUI) Intel 80386, for MS Windows, UPX compressed</p>
</blockquote>

<p>But, even this compressed file contain some data that indicate that we are dealing with an AutoIT compiled script,</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>&gt;&gt; strings codeit.exe | grep AU3                    
$pAU3
H}AU3!EA06M
AU3!EA06T
</pre></td></tr></tbody></table></code></div></div>
<p><strong><em>AU3!…</em></strong> it’s like the magic number of compiled Autoit scripts, that has <strong><em>.au3</em></strong> extension.</p>

<h2 id="running"><span class="mr-2">Running</span><a href="#running" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>So, the program works by receiving a text and creating a valid/authentic QR Code</p>

<p><a href="/assets/images/codeit-flare-7/program.png" class="popup img-link "><img data-src="/assets/images/codeit-flare-7/program.png" alt="" class="lazyload" data-proofer-ignore></a></p>

<p>The first software has the initial screen and the second I put a word and generate a QR Code, the software I was using to read this images (that I printed) is <a href="https://github.com/pshpsh/qtqr">qtqr</a>.</p>

<p>So, at first look the software only do that.</p>

<h1 id="autoit-extraction">AutoIT extraction</h1>

<p>The au3 script inside the autoit executable are compressed in the resource section, together with all the project files itself, I will use <a href="https://gitlab.com/x0r19x91/autoit-extractor">AutoITExtractor</a> to retrieve all files associated with this project.</p>

<p><a href="/assets/images/codeit-flare-7/autoitextracted.png" class="popup img-link "><img data-src="/assets/images/codeit-flare-7/autoitextracted.png" alt="" class="lazyload" data-proofer-ignore></a></p>

<p>I extracted every piece of this project, <strong><em>sprite.bmp</em></strong> (The initial image), <strong><em>qr_encoder.dll</em></strong> a library that create qr codes, created by <a href="https://www.nayuki.io/page/qr-code-generator-library0">Nayuki</a> and the script itself.</p>

<h1 id="the-pain-and-the-cure-of-obfuscation">The pain and the cure of obfuscation</h1>

<p>The entire script is obfuscated, so it’s almost impossible to read without a little strugle, but let’s dig down into this obfuscation technique.</p>

<p><a href="/assets/images/codeit-flare-7/obfuscation.png" class="popup img-link "><img data-src="/assets/images/codeit-flare-7/obfuscation.png" alt="" class="lazyload" data-proofer-ignore></a></p>

<h2 id="the-decode-table"><span class="mr-2">The decode table</span><a href="#the-decode-table" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Before the program logic even starts, there is a global decode table that are created, denoted by the variable <strong><em>$os</em></strong>, and the string values are encoded like:</p>

<p><a href="/assets/images/codeit-flare-7/os_table.png" class="popup img-link "><img data-src="/assets/images/codeit-flare-7/os_table.png" alt="" class="lazyload" data-proofer-ignore></a></p>

<p>In order to pick all the program strings we just need to copy all this data and split by the word <strong><em>4FD5$</em></strong>, I created a python decoder for that:</p>

<p><a href="/assets/images/codeit-flare-7/decode_dlit.png" class="popup img-link "><img data-src="/assets/images/codeit-flare-7/decode_dlit.png" alt="" class="lazyload" data-proofer-ignore></a></p>

<p>The idea here it’s very simple, I just split the string and transformed this string in hex representation in his really value, that way I created the same table used by the script, and now I can see the real strings.</p>

<p>Some of the strings are below:</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre>...
decoded_table[24] = b'kernel32.dll'
decoded_table[25] = b'int'
decoded_table[26] = b'GetComputerNameA'
decoded_table[27] = b'ptr'
decoded_table[28] = b'CodeIt Plus!'
decoded_table[29] = b'struct;byte['
decoded_table[30] = b'];endstruct'
decoded_table[31] = b'struct;byte[54];byte['
decoded_table[32] = b'struct;ptr;ptr;dword;byte[32];endstruct'
decoded_table[33] = b'advapi32.dll'
decoded_table[34] = b'CryptAcquireContextA'
decoded_table[35] = b'dword'
decoded_table[36] = b'CryptCreateHash'
decoded_table[37] = b'CryptHashData'
decoded_table[38] = b'struct*'
decoded_table[39] = b'CryptGetHashParam'
decoded_table[40] = b'0x'
decoded_table[41] = b'08020'
decoded_table[42] = b'00010'
decoded_table[43] = b'66000
...
</pre></td></tr></tbody></table></code></div></div>

<p>But I don’t stopped there, I need to at least make the code readable.</p>

<h2 id="the-obfuscator-algorithm"><span class="mr-2">The obfuscator algorithm</span><a href="#the-obfuscator-algorithm" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>So the way that obfuscator is:</p>

<ul>
  <li>It create a global decode table</li>
  <li>Its created a bunch of variable to represente numbers</li>
  <li>When some variable wants the string it will call the decode table with the index of the string</li>
  <li>The value will be send to a function that will do the job of <strong><em>unhexlify</em></strong> function</li>
</ul>

<p>Example:</p>

<p><a href="/assets/images/codeit-flare-7/obfuscator_logic.png" class="popup img-link "><img data-src="/assets/images/codeit-flare-7/obfuscator_logic.png" alt="" class="lazyload" data-proofer-ignore></a></p>

<p>The function <strong><em>arehdidxrgk</em></strong> is the function that will decode the string, in this case, it’s looking at the position <strong><em>4</em></strong> in the decode table, <strong><em>obs: In autoit/vbs the index starts at 1</em></strong>, so in this case, it’s looking the value <strong><em>‘biSize’</em></strong>.</p>

<h2 id="the-deobfuscator-algorithm"><span class="mr-2">The deobfuscator algorithm</span><a href="#the-deobfuscator-algorithm" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>So, how I managed to defeat this obfuscation ? Doing all this at once!</p>

<ul>
  <li>Create a regex rule to found all the <strong><em>Number(“ \d+ “)</em></strong> ocurrences</li>
  <li>If it’s the number is lower than the size of my decode table I save the variable name with the value</li>
  <li>Else I just hold the number value and the variable, because sometimes it wants just the number</li>
  <li>Then replace all <strong><em>$os[]</em></strong> by the value itself.</li>
</ul>

<h3 id="deobfuscator-code"><span class="mr-2">Deobfuscator code</span><a href="#deobfuscator-code" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">deobfuscate_content</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">decode_table</span><span class="p">):</span>
    <span class="n">index_rule</span> <span class="o">=</span> <span class="sa">r</span><span class="sh">'</span><span class="s">Number\(\" \d+ \"\)</span><span class="sh">'</span>

    <span class="n">number_table</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">finditer</span><span class="p">(</span><span class="n">index_rule</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
    <span class="n">decode_table_len</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">decode_table</span><span class="p">)</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Find and classify tokens
</span>    <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="n">number_table</span><span class="p">:</span>
        <span class="n">real_number</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">number</span><span class="p">.</span><span class="nf">group</span><span class="p">().</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="se">\"</span><span class="sh">"</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="n">real_number</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">real_number</span> <span class="o">-=</span> <span class="mi">1</span>
        
        <span class="n">variable_name</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="n">number</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span><span class="o">-</span><span class="mi">14</span><span class="p">:</span><span class="n">number</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">real_number</span> <span class="o">&gt;=</span> <span class="n">decode_table_len</span><span class="p">:</span>
            <span class="n">tokens</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">real_value</span><span class="sh">'</span><span class="p">:</span> <span class="sh">''</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">number</span><span class="sh">'</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">real_number</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">is_encoded</span><span class="sh">'</span><span class="p">:</span> <span class="bp">False</span>
            <span class="p">}</span>
            <span class="k">continue</span>

        <span class="n">real_value</span> <span class="o">=</span> <span class="n">decode_table</span><span class="p">[</span><span class="n">real_number</span><span class="p">]</span>
        <span class="n">tokens</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">real_value</span><span class="sh">'</span><span class="p">:</span> <span class="n">real_value</span><span class="p">.</span><span class="nf">decode</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">number</span><span class="sh">'</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">real_number</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">is_encoded</span><span class="sh">'</span><span class="p">:</span> <span class="bp">True</span>
        <span class="p">}</span>

    <span class="c1"># Replace the values
</span>    <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="sh">'</span><span class="s">is_encoded</span><span class="sh">'</span><span class="p">]:</span> <span class="c1"># If has a value in decode_table
</span>            <span class="n">replace_var</span> <span class="o">=</span> <span class="sh">"</span><span class="s">$os[{}]</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">replace_var</span><span class="p">,</span> <span class="sh">'</span><span class="se">\"</span><span class="s">{}</span><span class="se">\"</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="sh">'</span><span class="s">real_value</span><span class="sh">'</span><span class="p">]))</span>
        
        <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="sh">'</span><span class="s">number</span><span class="sh">'</span><span class="p">])</span>




    <span class="k">return</span> <span class="n">content</span>        
    
</pre></td></tr></tbody></table></code></div></div>

<p>The final code looks like:</p>

<p><a href="/assets/images/codeit-flare-7/deobfuscated.png" class="popup img-link "><img data-src="/assets/images/codeit-flare-7/deobfuscated.png" alt="" class="lazyload" data-proofer-ignore></a></p>

<p>Now, let’s start the real challenge, this is far from finish.</p>

<h1 id="windows-crypto-functions">Windows crypto functions</h1>

<p>You already have noticed that has come calls to <strong><em>CryptAcquireContextA</em></strong> and <strong><em>CryptDecrypt</em></strong>, in order to AutoIT call this native functions it will use a special call called <strong><em>DllCall</em></strong> and the values must be created as an struct in memory with <strong><em>DllStructCreate</em></strong>, this structures holds the same memory representation as this function will received if was called by the native code.</p>

<p>I recreated all this encryption part in C++, and it will be very easy to show what is happening here, because I already did all the dirty work to read each value in the struct passed and rebuild exactly the same call, if you don’t have windows SDK, you can follow all this using the <a href="https://github.com/wine-mirror/wine/blob/master/include/wincrypt.h">wincrypt.h</a> from wine,so let’s in parts:</p>

<p><a href="https://docs.microsoft.com/en-us/windows/win32/api/wincrypt/nf-wincrypt-cryptacquirecontexta">CryptAcquireContextA</a> starts a new “encryption session” in Windows, using the handler we can access the crypto features, and this function must be called with the correct params that we want in our encryption.</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="n">BOOL</span> <span class="nf">CryptAcquireContextA</span><span class="p">(</span>
  <span class="n">HCRYPTPROV</span> <span class="o">*</span><span class="n">phProv</span><span class="p">,</span>
  <span class="n">LPCSTR</span>     <span class="n">szContainer</span><span class="p">,</span>
  <span class="n">LPCSTR</span>     <span class="n">szProvider</span><span class="p">,</span>
  <span class="n">DWORD</span>      <span class="n">dwProvType</span><span class="p">,</span>
  <span class="n">DWORD</span>      <span class="n">dwFlags</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="n">HCRYPTPROV</span> <span class="n">cryptContext</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">CryptAcquireContext</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cryptContext</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">PROV_RSA_AES</span><span class="p">,</span> <span class="mi">4026531840</span><span class="p">))</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>So this will start a session that will use AES for RSA keys.</p>

<p><a href="https://docs.microsoft.com/en-us/windows/win32/api/wincrypt/nf-wincrypt-cryptcreatehash">CryptCreateHash</a> will start a new hash algorithm using the previous context, in this case:</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>BOOL CryptCreateHash(
  HCRYPTPROV hProv,
  ALG_ID     Algid,
  HCRYPTKEY  hKey,
  DWORD      dwFlags,
  HCRYPTHASH *phHash
);
</pre></td></tr></tbody></table></code></div></div>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="n">HCRYPTHASH</span> <span class="n">hash</span><span class="p">;</span>
<span class="n">CryptCreateHash</span><span class="p">(</span>
    <span class="n">cryptContext</span><span class="p">,</span>
    <span class="n">CALG_SHA_256</span><span class="p">,</span> <span class="c1">// 32780</span>
    <span class="nb">NULL</span><span class="p">,</span>
    <span class="nb">NULL</span><span class="p">,</span>
    <span class="o">&amp;</span><span class="n">hash</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>
<p>Now it will use <a href="https://docs.microsoft.com/en-us/windows/win32/api/wincrypt/nf-wincrypt-crypthashdata">CryptHashData</a> to hash the data from <strong><em>flisilaylnraw</em></strong> variable (I will back in this names too) and will retrieve the results with <a href="https://docs.microsoft.com/en-us/windows/win32/api/wincrypt/nf-wincrypt-cryptgethashparam">CryptGetHashParam</a>.</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="n">BOOL</span> <span class="nf">CryptHashData</span><span class="p">(</span>
  <span class="n">HCRYPTHASH</span> <span class="n">hHash</span><span class="p">,</span>
  <span class="k">const</span> <span class="n">BYTE</span> <span class="o">*</span><span class="n">pbData</span><span class="p">,</span>
  <span class="n">DWORD</span>      <span class="n">dwDataLen</span><span class="p">,</span>
  <span class="n">DWORD</span>      <span class="n">dwFlags</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="n">BOOL</span> <span class="nf">CryptGetHashParam</span><span class="p">(</span>
  <span class="n">HCRYPTHASH</span> <span class="n">hHash</span><span class="p">,</span>
  <span class="n">DWORD</span>      <span class="n">dwParam</span><span class="p">,</span>
  <span class="n">BYTE</span>       <span class="o">*</span><span class="n">pbData</span><span class="p">,</span>
  <span class="n">DWORD</span>      <span class="o">*</span><span class="n">pdwDataLen</span><span class="p">,</span>
  <span class="n">DWORD</span>      <span class="n">dwFlags</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="n">CryptHashData</span><span class="p">(</span><span class="n">hash</span><span class="p">,</span> <span class="n">input</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">CryptGetHashParam</span><span class="p">(</span><span class="n">hash</span><span class="p">,</span> <span class="n">HP_HASHVAL</span><span class="p">,</span> <span class="n">hashedData</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hashSize</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)){</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Now, it will concat this value with another hex value:</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="o">+</span> <span class="o">&lt;</span><span class="n">hashed_data</span><span class="o">&gt;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>This value, is actually a <a href="https://docs.microsoft.com/en-us/windows/win32/api/wincrypt/ns-wincrypt-publickeystruc">PUBLICKEYSTRUC</a> that come when you export you created key by using <a href="https://docs.microsoft.com/en-us/windows/win32/api/wincrypt/nf-wincrypt-cryptexportkey">CryptExportKey</a> function.</p>

<p><a href="/assets/images/codeit-flare-7/pubkeystruct.png" class="popup img-link "><img data-src="/assets/images/codeit-flare-7/pubkeystruct.png" alt="" class="lazyload" data-proofer-ignore></a></p>

<p>So, there is a bunch of encrypted data in this part, and the created key will be imported with <a href="https://docs.microsoft.com/en-us/windows/win32/api/wincrypt/nf-wincrypt-cryptimportkey">CryptImportKey</a> function and later this encrypted data will be decrypted by <a href="https://docs.microsoft.com/en-us/windows/win32/api/wincrypt/nf-wincrypt-cryptdecrypt">CryptDecrypt</a>, if the decryption is sucessfully, our flag will be placed in our QRCode.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>BOOL CryptImportKey(
  HCRYPTPROV hProv,
  const BYTE *pbData,
  DWORD      dwDataLen,
  HCRYPTKEY  hPubKey,
  DWORD      dwFlags,
  HCRYPTKEY  *phKey
);
</pre></td></tr></tbody></table></code></div></div>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>BOOL CryptDecrypt(
  HCRYPTKEY  hKey,
  HCRYPTHASH hHash,
  BOOL       Final,
  DWORD      dwFlags,
  BYTE       *pbData,
  DWORD      *pdwDataLen
);
</pre></td></tr></tbody></table></code></div></div>

<p>So, I created an entire decrypt system based in this algorithm, but guess so ? It’s not the way to beat this challenge, but is fundamental to understand that part.</p>

<h2 id="the-unused-brute-force-function"><span class="mr-2">The unused brute force function</span><a href="#the-unused-brute-force-function" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<div class="language-c++ highlighter-rouge"><div class="code-header">
        <span data-label-text="C++"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
</pre></td><td class="rouge-code"><pre><span class="kt">bool</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">BYTE</span><span class="o">*</span> <span class="n">candidate_password</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>


	<span class="kt">bool</span> <span class="n">ok</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">HCRYPTPROV</span> <span class="n">cryptContext</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">CryptAcquireContext</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cryptContext</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">PROV_RSA_AES</span><span class="p">,</span> <span class="mi">4026531840</span><span class="p">))</span> <span class="p">{</span>
		<span class="c1">/// Context ok</span>
		<span class="c1">// 32 bytes sha256 + public key header with 12 bytes</span>
		<span class="n">BYTE</span> <span class="n">key</span><span class="p">[</span><span class="n">KEY_SIZE</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">};</span> <span class="c1">// Partial key</span>
		<span class="n">BYTE</span> <span class="n">encData</span><span class="p">[</span><span class="n">ENC_DATA_SIZE</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0xcd</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0xc6</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">,</span> <span class="mh">0xcf</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0xbd</span><span class="p">,</span> <span class="mh">0xa1</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0xd8</span><span class="p">,</span> <span class="mh">0x91</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x92</span><span class="p">,</span> <span class="mh">0xa</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0xf3</span><span class="p">,</span> <span class="mh">0x96</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span> <span class="mh">0xc4</span><span class="p">,</span> <span class="mh">0x59</span><span class="p">,</span> <span class="mh">0xea</span><span class="p">,</span> <span class="mh">0x7</span><span class="p">,</span> <span class="mh">0xb7</span><span class="p">,</span> <span class="mh">0x9e</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xd1</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0xae</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0xb1</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0xf6</span><span class="p">,</span> <span class="mh">0xcb</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0xb3</span><span class="p">,</span> <span class="mh">0xc4</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0xa5</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x5f</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0xfb</span><span class="p">,</span> <span class="mh">0x3b</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x52</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0x3a</span><span class="p">,</span> <span class="mh">0xec</span><span class="p">,</span> <span class="mh">0xaf</span><span class="p">,</span> <span class="mh">0x3d</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0xe</span><span class="p">,</span> <span class="mh">0x98</span><span class="p">,</span> <span class="mh">0xbf</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x5d</span><span class="p">,</span> <span class="mh">0xaf</span><span class="p">,</span> <span class="mh">0x97</span><span class="p">,</span> <span class="mh">0x4e</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x5d</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0x75</span><span class="p">,</span> <span class="mh">0xb2</span><span class="p">,</span> <span class="mh">0xc3</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x7a</span><span class="p">,</span> <span class="mh">0xe4</span><span class="p">,</span> <span class="mh">0xd2</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0xa3</span><span class="p">,</span> <span class="mh">0x7b</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0xf2</span><span class="p">,</span> <span class="mh">0xc5</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0xbf</span><span class="p">,</span> <span class="mh">0x3a</span><span class="p">,</span> <span class="mh">0x9e</span><span class="p">,</span> <span class="mh">0xa6</span><span class="p">,</span> <span class="mh">0xa5</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0xf9</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x5e</span><span class="p">,</span> <span class="mh">0xae</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0xe6</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0xde</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0xfd</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x9c</span><span class="p">,</span> <span class="mh">0xc4</span><span class="p">,</span> <span class="mh">0xce</span><span class="p">,</span> <span class="mh">0x5b</span><span class="p">,</span> <span class="mh">0xb0</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0xf9</span><span class="p">,</span> <span class="mh">0xbd</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0xf9</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">,</span> <span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0xe6</span><span class="p">,</span> <span class="mh">0x9e</span><span class="p">,</span> <span class="mh">0xb9</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0xf4</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="mh">0xee</span><span class="p">,</span> <span class="mh">0xde</span><span class="p">,</span> <span class="mh">0xdc</span><span class="p">,</span> <span class="mh">0xeb</span><span class="p">,</span> <span class="mh">0xa7</span><span class="p">,</span> <span class="mh">0x91</span><span class="p">,</span> <span class="mh">0x46</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0xfb</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0xf1</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x5d</span><span class="p">,</span> <span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0xb1</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0x3b</span><span class="p">,</span> <span class="mh">0xed</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x6a</span><span class="p">,</span> <span class="mh">0xe4</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x52</span><span class="p">,</span> <span class="p">};</span>


		<span class="n">PUBLICKEYSTRUC</span><span class="o">*</span> <span class="n">pubstruct</span> <span class="o">=</span> <span class="p">(</span><span class="n">PUBLICKEYSTRUC</span><span class="o">*</span><span class="p">)</span> <span class="n">key</span><span class="p">;</span>
		<span class="n">std</span><span class="o">::</span><span class="n">printf</span><span class="p">(</span><span class="s">"Key type: 0x%x</span><span class="se">\n</span><span class="s">Alg id: 0x%x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">pubstruct</span><span class="o">-&gt;</span><span class="n">bType</span><span class="p">,</span> <span class="n">pubstruct</span><span class="o">-&gt;</span><span class="n">aiKeyAlg</span><span class="p">);</span>


		<span class="n">HCRYPTHASH</span> <span class="n">hash</span><span class="p">;</span>
		<span class="n">CryptCreateHash</span><span class="p">(</span>
			<span class="n">cryptContext</span><span class="p">,</span>
			<span class="n">CALG_SHA_256</span><span class="p">,</span> <span class="c1">// 32780</span>
			<span class="nb">NULL</span><span class="p">,</span>
			<span class="nb">NULL</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">hash</span><span class="p">);</span>

		<span class="c1">// Hash created</span>
		<span class="k">const</span> <span class="n">BYTE</span><span class="o">*</span> <span class="n">userinput</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="n">BYTE</span><span class="o">*</span><span class="p">)</span><span class="n">candidate_password</span><span class="p">;</span>
		<span class="n">BYTE</span> <span class="n">hashedData</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
		<span class="n">DWORD</span> <span class="n">hashSize</span><span class="p">;</span>

<span class="c1">//		puts("Hashing value...");</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">CryptHashData</span><span class="p">(</span><span class="n">hash</span><span class="p">,</span> <span class="n">userinput</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">CryptGetHashParam</span><span class="p">(</span><span class="n">hash</span><span class="p">,</span> <span class="n">HP_HASHVAL</span><span class="p">,</span> <span class="n">hashedData</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hashSize</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)){</span>
			<span class="c1">// sha256 hash</span>
<span class="c1">//			puts("Building the candidate private key...");</span>
			<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">hashSize</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">key</span><span class="p">[</span><span class="n">INITIAL_SIZE</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">hashedData</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="p">}</span>

			<span class="c1">// Create </span>

			<span class="n">HCRYPTPROV</span> <span class="n">decryptContext</span><span class="p">;</span>
			<span class="n">HCRYPTKEY</span> <span class="n">privKey</span><span class="p">;</span>
			<span class="c1">//puts("Importing key...");</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">CryptAcquireContext</span><span class="p">(</span><span class="o">&amp;</span><span class="n">decryptContext</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">4026531840</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">CryptImportKey</span><span class="p">(</span><span class="n">decryptContext</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">KEY_SIZE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">privKey</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">puts</span><span class="p">(</span><span class="s">"[+] Key imported! [+]</span><span class="se">\n</span><span class="s">Starting decryption..."</span><span class="p">);</span>
				<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">KEY_SIZE</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">printf</span><span class="p">(</span><span class="s">"%x"</span><span class="p">,</span> <span class="n">key</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
				<span class="p">}</span>
				<span class="n">DWORD</span> <span class="n">data_len</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">CryptDecrypt</span><span class="p">(</span><span class="n">privKey</span><span class="p">,</span> <span class="n">hash</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">encData</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">data_len</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">puts</span><span class="p">(</span><span class="s">"[+] Decrypted!! [+]"</span><span class="p">);</span>

					<span class="n">printf</span><span class="p">(</span><span class="s">"Hex value: "</span><span class="p">);</span>
					<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ENC_DATA_SIZE</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
						<span class="n">printf</span><span class="p">(</span><span class="s">"%x"</span><span class="p">,</span> <span class="n">encData</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
					<span class="p">}</span>

					<span class="n">printf</span><span class="p">(</span><span class="s">"Char value: "</span><span class="p">);</span>
					<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ENC_DATA_SIZE</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
						<span class="n">printf</span><span class="p">(</span><span class="s">"%c"</span><span class="p">,</span> <span class="n">encData</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
					<span class="p">}</span>
					
					<span class="n">printf</span><span class="p">(</span><span class="s">"Key used: "</span><span class="p">);</span>
					<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">KEY_SIZE</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
						<span class="n">printf</span><span class="p">(</span><span class="s">"%x"</span><span class="p">,</span> <span class="n">key</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
					<span class="p">}</span>
					<span class="n">ok</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">GetLastError</span><span class="p">());</span>
				<span class="n">CryptDestroyKey</span><span class="p">(</span><span class="n">privKey</span><span class="p">);</span>
				<span class="n">CryptDestroyHash</span><span class="p">(</span><span class="n">hash</span><span class="p">);</span>

			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">ok</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h1 id="the-computer-name-function">The computer name function</h1>

<p>Later on I realized that my input was never sent to the encryption part, but was another value, this value was my computer name that the script gets my calling <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-getcomputernamea">GetComputerNameA</a> function, then the name of my computer is passed to a function that will do a lot of operation up my computer name bytes and just after that, this decryption routine is called.</p>

<p><strong><em>obs: At this point I already renamed a lot of functions name, so it’s very clean righ now</em></strong></p>

<p><a href="/assets/images/codeit-flare-7/inject_flag.png" class="popup img-link "><img data-src="/assets/images/codeit-flare-7/inject_flag.png" alt="" class="lazyload" data-proofer-ignore></a></p>

<p>So, here my computer name is saved and then passed to a function that a called <strong><em>PrepareComputerName</em></strong></p>

<h2 id="preparecomputername-function"><span class="mr-2">PrepareComputerName function</span><a href="#preparecomputername-function" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p><a href="/assets/images/codeit-flare-7/prepare_computername.png" class="popup img-link "><img data-src="/assets/images/codeit-flare-7/prepare_computername.png" alt="" class="lazyload" data-proofer-ignore></a></p>

<p>The key to beat this challenge is here, the script will load the <strong><em>sprite.bmp</em></strong> image and will see if it has some content after 54 bytes (After the bitmap header), and will start to loop in each of our computer name value and do the following steps:</p>

<p>Inside bitmap loop</p>

<ul>
  <li>Read 6 bytes from the bitmap file</li>
  <li>For each byte it will check if has a <a href="https://en.wikipedia.org/wiki/Bit_numbering#Least_significant_bit">Least significant bit</a></li>
  <li>If has, it will be shift left this bit by the loop number it are righ now</li>
  <li>It will sum that to the current variable name</li>
</ul>

<p>Out bitmap loop:</p>
<ul>
  <li>It will remove the LSB</li>
  <li>Then will sum this value by 128 (1«7)</li>
</ul>

<p>What the **ck is this ? I don’t picke-up 100% of this encoding technique, but the important part is, the key is actually encoded here, if we just ignore the fact that we are increasing the computer name byte and just get the encoded value in the bitmap, we will be able to recover the key. Because this function guarante that if the computername is wrong it will be changed by the encode schema.</p>

<p>I rewritten this routine to give us the key, and for better understanding:</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">sys</span>
<span class="kn">import</span> <span class="n">hashlib</span>

<span class="n">sprite_content</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">sprite.bmp</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">rb</span><span class="sh">"</span><span class="p">).</span><span class="nf">read</span><span class="p">()</span>
<span class="n">hostname</span> <span class="o">=</span> <span class="p">[</span><span class="nf">ord</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">lower</span><span class="p">()]</span>

<span class="n">sprite_content</span> <span class="o">=</span> <span class="n">sprite_content</span><span class="p">[</span><span class="mi">54</span><span class="p">:]</span> <span class="c1"># Remove header
</span>
<span class="n">out</span> <span class="o">=</span> <span class="sh">""</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">extracted</span> <span class="o">=</span> <span class="sh">""</span>


<span class="n">flag</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">hostname</span><span class="p">)):</span>
	<span class="n">number_at</span> <span class="o">=</span> <span class="n">hostname</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
	<span class="n">real_value</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Picking {} </span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">number_at</span><span class="p">))</span>
	<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
		<span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">sprite_content</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">j</span>
		<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">({} &amp; 1) &lt;&lt; {} = {}</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">sprite_content</span><span class="p">[</span><span class="n">count</span><span class="p">],</span> <span class="n">j</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
		<span class="n">number_at</span> <span class="o">+=</span> <span class="n">f</span>
		<span class="n">real_value</span> <span class="o">+=</span> <span class="n">f</span>
		<span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
	
	<span class="n">flag</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">chr</span><span class="p">(</span><span class="n">real_value</span><span class="p">))</span>
	<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Result {}</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">number_at</span><span class="p">))</span>

		
	<span class="n">sum_lsb</span> <span class="o">=</span> <span class="p">(</span><span class="n">number_at</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">number_at</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">)</span>
	<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Appling ({0} &gt;&gt; 1) + (({0} &amp; 1)) &lt;&lt; 7) = {1}</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">number_at</span><span class="p">,</span> <span class="n">sum_lsb</span><span class="p">))</span>
	<span class="n">out</span> <span class="o">+=</span> <span class="nf">chr</span><span class="p">(</span><span class="n">sum_lsb</span><span class="p">)</span>



<span class="nf">print</span><span class="p">(</span><span class="sh">''</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">flag</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">([</span> <span class="nf">hex</span><span class="p">(</span><span class="nf">ord</span><span class="p">(</span><span class="n">o</span><span class="p">))</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">out</span> <span class="p">]))</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">out</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></div></div>

<p>If will run with any input and the bitmap, we will get the encoded value + the operation result value:</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre>python3 decode.py THISISAVERYGO                                                                                                                                      
Picking 116 
(255 &amp; 1) &lt;&lt; 6 = 64
(255 &amp; 1) &lt;&lt; 5 = 32
(254 &amp; 1) &lt;&lt; 4 = 0
(254 &amp; 1) &lt;&lt; 3 = 0
(254 &amp; 1) &lt;&lt; 2 = 0
(254 &amp; 1) &lt;&lt; 1 = 0
(255 &amp; 1) &lt;&lt; 0 = 1
Result 213
Appling (213 &gt;&gt; 1) + ((213 &amp; 1)) &lt;&lt; 7) = 234
Picking 104 
(255 &amp; 1) &lt;&lt; 6 = 64
(255 &amp; 1) &lt;&lt; 5 = 32
(255 &amp; 1) &lt;&lt; 4 = 16
(254 &amp; 1) &lt;&lt; 3 = 0
(255 &amp; 1) &lt;&lt; 2 = 4
(254 &amp; 1) &lt;&lt; 1 = 0
(255 &amp; 1) &lt;&lt; 0 = 1
Result 221
....
aut01tfan1999
êîîÑMóãëéÑYPT
0xea 0xee 0xee 0xd1 0x4d 0xf3 0xe3 0xeb 0xe9 0xd1 0x59 0x50 0x54
13
</pre></td></tr></tbody></table></code></div></div>

<p>The encoded value is <strong><em>aut01tfan1999</em></strong> if we pass this value as the input of this function, it will get the same as output:</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>...
Result 114
Appling (114 &gt;&gt; 1) + ((114 &amp; 1)) &lt;&lt; 7) = 57
aut01tfan1999
aut01tfan1999
0x61 0x75 0x74 0x30 0x31 0x74 0x66 0x61 0x6e 0x31 0x39 0x39 0x39
</pre></td></tr></tbody></table></code></div></div>

<h1 id="finally-the-flag">Finally, the flag</h1>

<p>Nice, we can now open the project in AutoIT editor and change the computer name or change our computer name and reboot.</p>

<p><a href="/assets/images/codeit-flare-7/flag.png" class="popup img-link "><img data-src="/assets/images/codeit-flare-7/flag.png" alt="" class="lazyload" data-proofer-ignore></a></p>

<p>That one, was very hard to pick-up and I did a LOT of research in many topics, the resolution was far from what I was looking at the beginning, but still a very nice and amazing challenge!</p>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  
  <div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i>
    
      <a href='/categories/reverse-engineering/'>Reverse-Engineering</a>
  </div>
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i>
      
      <a href="/tags/ctf/"
          class="post-tag no-text-decoration" >ctf</a>
      
      <a href="/tags/reverse-engineering/"
          class="post-tag no-text-decoration" >Reverse engineering</a>
      
      <a href="/tags/programming/"
          class="post-tag no-text-decoration" >Programming</a>
      
      <a href="/tags/windows-reversing/"
          class="post-tag no-text-decoration" >Windows reversing</a>
      
      <a href="/tags/obfuscation-analysis/"
          class="post-tag no-text-decoration" >obfuscation analysis</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.

      
    </div>

    <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=The%20Flare%207th%20AutoIT%20challenge%20-%20Reversing%20codes&url=https%3A%2F%2Freversing.codes%2Fposts%2FCode-it-flare-7%2F" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=The%20Flare%207th%20AutoIT%20challenge%20-%20Reversing%20codes&u=https%3A%2F%2Freversing.codes%2Fposts%2FCode-it-flare-7%2F" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://t.me/share/url?url=https%3A%2F%2Freversing.codes%2Fposts%2FCode-it-flare-7%2F&text=The%20Flare%207th%20AutoIT%20challenge%20-%20Reversing%20codes" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="Copy link"
        data-title-succeed="Link copied successfully!">
    </i>

  </span>
</div>


  </div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->


      
    
    

    </div>
  </div> <!-- #core-wrapper -->

  <!-- panel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted">

    <div class="access">
      















  <div id="access-lastmod" class="post">
    <div class="panel-heading">Recently Updated</div>
    <ul class="post-content pl-0 pb-1 ml-1 mt-2">
      
        
        
        
      <li><a href="/posts/PlayStation-5-ELF-Injection/">Usermode ELF injection on the PlayStation 5</a></li>
      
        
        
        
      <li><a href="/posts/ps4-kernel-patching-guide/">How to patch the running PlayStation 4 kernel</a></li>
      
        
        
        
      <li><a href="/posts/Stop-Using-GetProcAddress-And-Let-The-Linker/">Quick Tip: Stop Using GetProcAddress and Let the Linker Do the Job for You</a></li>
      
        
        
        
      <li><a href="/posts/Manual-unpacking-in-details/">Manual Unpacking in Details</a></li>
      
        
        
        
      <li><a href="/posts/Manipulating-elf-with-felf/">Manipulating elf files in C++ using felf</a></li>
      
    </ul>
  </div> <!-- #access-lastmod -->



      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/programming/">Programming</a>
    
      
      <a class="post-tag" href="/tags/reverse-engineering/">Reverse engineering</a>
    
      
      <a class="post-tag" href="/tags/malware-research/">Malware Research</a>
    
      
      <a class="post-tag" href="/tags/ctf/">ctf</a>
    
      
      <a class="post-tag" href="/tags/windows-internals/">Windows Internals</a>
    
      
      <a class="post-tag" href="/tags/freebsd/">FreeBSD</a>
    
      
      <a class="post-tag" href="/tags/malware-analysis/">Malware analysis</a>
    
      
      <a class="post-tag" href="/tags/malware-research/">Malware research</a>
    
      
      <a class="post-tag" href="/tags/network-analysis/">Network analysis</a>
    
      
      <a class="post-tag" href="/tags/obfuscation-analysis/">obfuscation analysis</a>
    

    </div>
  </div>


    </div>

    
      
      



  <div id="toc-wrapper" class="pl-0 pr-4 mb-5">
    <div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
    <nav id="toc"></nav>
  </div>

  <!-- toc.js will be loaded at medium priority -->
  <script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script>


    
  </div>

</div>

<!-- tail -->

<div class="row">
  <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5">
    
      
      <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->





  <div id="related-posts" class="mb-2 mb-sm-4">
    <h3 class="pt-2 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/VBA-Stomping-flare/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1603495416"
    data-df="ll"
    >
  Oct 23, 2020
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>VBA Stomping: The macro hidden in plain sight</h3>
            <div class="text-muted small">
              <p>
                





                At Flare-on 7th there was a very interesting malware analysis challenge that envolved a very unique hide technique for malicious Macros. This technique is called VBA Stomp, this works by hiding the...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/Manipulating-elf-with-felf/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1606759236"
    data-df="ll"
    >
  Nov 30, 2020
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Manipulating elf files in C++ using felf</h3>
            <div class="text-muted small">
              <p>
                





                A couple months ago I created felf, a library to parse ELF files into C++ structures, the reason for this was to have a way in C++ to work on ELF files using STL structures like vector, unordered m...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/Hacking-PHP-Console-Hackthebox/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1588120296"
    data-df="ll"
    >
  Apr 28, 2020
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Beating Console challenge from Hackthebox</h3>
            <div class="text-muted small">
              <p>
                





                This challenge from hackthebox, give you an address with a running PHP application, when you open the web page, you will notice a phpinfo() page with:

Your IP is 10.255.0.2 Make sure to load php-c...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->


    
      
      <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/bipartite-graph-for-threats/" class="btn btn-outline-primary"
    prompt="Older">
    <p>Using bipartite Graphs to detect Malware campaigns</p>
  </a>
  

  
  <a href="/posts/VBA-Stomping-flare/" class="btn btn-outline-primary"
    prompt="Newer">
    <p>VBA Stomping: The macro hidden in plain sight</p>
  </a>
  

</div>

    
      
      <!--  The comments switcher -->


    
  </div>
</div>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/programming/">Programming</a>
    
      
      <a class="post-tag" href="/tags/reverse-engineering/">Reverse engineering</a>
    
      
      <a class="post-tag" href="/tags/malware-research/">Malware Research</a>
    
      
      <a class="post-tag" href="/tags/ctf/">ctf</a>
    
      
      <a class="post-tag" href="/tags/windows-internals/">Windows Internals</a>
    
      
      <a class="post-tag" href="/tags/freebsd/">FreeBSD</a>
    
      
      <a class="post-tag" href="/tags/malware-analysis/">Malware analysis</a>
    
      
      <a class="post-tag" href="/tags/malware-research/">Malware research</a>
    
      
      <a class="post-tag" href="/tags/network-analysis/">Network analysis</a>
    
      
      <a class="post-tag" href="/tags/obfuscation-analysis/">obfuscation analysis</a>
    

    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    <!-- The Footer -->

<footer>
  <div class="container pl-lg-4 pr-lg-4">
    <div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3">
      <div class="footer-left">
        <p class="mb-0">
          © 2025
          <a href="https://github.com/buzzer-re">Buzzer</a>.
          
          <span data-toggle="tooltip" data-placement="top"
            title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
          
        </p>
      </div>

      <div class="footer-right">
        <p class="mb-0">Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>.
        </p>
      </div>
    </div>
  </div>
</footer>


    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    
      <div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true"
        data-animation="true" data-autohide="false">
        <div class="toast-header">
          <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="toast-body text-center pt-0">
          <p class="pl-2 pr-2 mb-3">A new version of content is available.</p>
          <button type="button" class="btn btn-primary" aria-label="Update">
            Update
          </button>
        </div>
      </div>
    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No results found.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!-- JS selector for site. -->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup & clipboard -->
  

  







  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js"></script>





  

  

  







  
    

    

  



  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1.11.6/dayjs.min.js,npm/dayjs@1.11.6/locale/en.min.js,npm/dayjs@1.11.6/plugin/relativeTime.min.js,npm/dayjs@1.11.6/plugin/localizedFormat.min.js"></script>







<script defer src="/assets/js/dist/post.min.js"></script>



<!-- commons -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>




  </body>

</html>

