<!DOCTYPE html>









<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en"
  
    data-mode="dark"
  
>

  <!-- The Head -->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  >

  
    

    
  

  

  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Manual Unpacking in Details" />
<meta property="og:locale" content="en" />
<meta name="description" content="A simple blog to post any subject that I may find useful to share :)" />
<meta property="og:description" content="A simple blog to post any subject that I may find useful to share :)" />
<link rel="canonical" href="https://reversing.codes/posts/Manual-unpacking-in-details/" />
<meta property="og:url" content="https://reversing.codes/posts/Manual-unpacking-in-details/" />
<meta property="og:site_name" content="Reversing codes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-03-20T19:10:00-03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Manual Unpacking in Details" />
<meta name="twitter:site" content="@buzz3r_" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-07-11T18:31:39-03:00","datePublished":"2023-03-20T19:10:00-03:00","description":"A simple blog to post any subject that I may find useful to share :)","headline":"Manual Unpacking in Details","mainEntityOfPage":{"@type":"WebPage","@id":"https://reversing.codes/posts/Manual-unpacking-in-details/"},"url":"https://reversing.codes/posts/Manual-unpacking-in-details/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>Manual Unpacking in Details | Reversing codes
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Reversing codes">
<meta name="application-name" content="Reversing codes">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/style.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js"></script>

  
</head>


  <body data-topbar-visible="true">

    <!--
  The Side Bar
-->
<style>
  body {
      text-align: justify;
  }
  </style>
  
<div id="sidebar" class="d-flex flex-column align-items-end">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" class="mx-auto">
        
          
          <img src="https://avatars.githubusercontent.com/u/22428720" alt="avatar" onerror="this.style.display='none'">
        
      </a>
    </div>

    <div class="site-title">
      <a href="/">Buzzer's blog</a>
    </div>
    <div class="site-subtitle font-italic">Security Researcher & Dreamer</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">

    

    
      

      
      <a href="https://github.com/buzzer-re" aria-label="github"
        
        
          
          target="_blank"
        

        

        rel="noopener">
        <i class="fab fa-github"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/buzz3r_" aria-label="twitter"
        
        
          
          target="_blank"
        

        

        rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        
        

        

        >
        <i class="fas fa-rss"></i>
      </a>
      

    

  </div> <!-- .sidebar-bottom -->

      <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-V8QSGFHYFB"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        id = 'G-V8QSGFHYFB'
        gtag('config', id);
    </script>
</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper">
  <div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4">
    <span id="breadcrumb">

    

    

      

        
          <span>
            <a href="/">
              Home
            </a>
          </span>

        

      

        

      

        

          
            <span>Manual Unpacking in Details</span>
          

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div id="main" class="container pl-xl-4 pr-xl-4">
        





<div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4">
    <div class="post pl-1 pr-1 pl-md-2 pr-md-2">

    

    
      
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->


<!-- images -->




  
  

  <!-- CDN URL -->
  

  <!-- Add image path -->
  

  
    
      
      
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  

  



<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  

  
  

  




<!-- return -->

<h1 data-toc-skip>Manual Unpacking in Details</h1>

<div class="post-meta text-muted">
    <!-- published date -->
    <span>
      Posted
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class=""
    data-ts="1679350200"
    data-df="ll"
    data-toggle="tooltip" data-placement="bottom">
  Mar 20, 2023
</em>

    </span>

    <!-- lastmod date -->
    
    <span>
      Updated
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class=""
    data-ts="1689111099"
    data-df="ll"
    data-toggle="tooltip" data-placement="bottom">
  Jul 11, 2023
</em>

    </span>
    

  

  <div class="d-flex justify-content-between">
    <!-- author(s) -->
    <span>
      

      By

      <em>
      
        <a href="https://github.com/buzzer-re">Buzzer</a>
      
      </em>
    </span>

    <div>
      <!-- page views -->
      

      <!-- read time -->
      <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="2778 words">
  <em>15 min</em> read</span>

    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <style>
body {
    text-align: justify;
}
</style>

<p>Wow, it’s been more than two years since my last blog post. Time flies! But now, in 2023, I am eager to start filling this blog with cool and useful content, and I hope to maintain it for a long time.</p>

<p>As a welcome back post, I want to share an unpacking of a random sample of the <a href="https://bazaar.abuse.ch/sample/4daa4b6dfe81b31c09d7d3019eef4d84c071962069fd9c6603e810f88182b80c/">Redline</a> stealer that I found inside Malware Bazaar. The purpose of this post is not to analyze the malware, but rather to dive into the process of manual unpacking and extract deep information about the packer itself.</p>

<p><strong><em>While writing this post, I discovered that this is an updated version of the packer that was described by <a href="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/">Fumik0</a>, in 2021. Although there have been some minor changes to some of its components, I will still use this sample to demonstrate the unpacking process.</em></strong></p>

<h1 id="spliting-the-multi-stage-loader">Spliting the multi-stage loader</h1>

<p>This sample loads its final payload in a multi-stage procedure, which means that there are a couple of steps involved before the actual malware is executed.</p>

<h2 id="the-bad-the-good-and-the-ugly-unpack-formula"><span class="mr-2">The bad, the good and the ugly unpack formula</span><a href="#the-bad-the-good-and-the-ugly-unpack-formula" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Most of the unpacking is done by monitoring memory allocations, breaking at <code class="language-plaintext highlighter-rouge">VirtualAlloc</code> or <code class="language-plaintext highlighter-rouge">LocalAlloc</code>, and verifying any memory protection modifications with <code class="language-plaintext highlighter-rouge">VirtualProtect</code> and so on. However, for the purpose of this analysis, I want to focus on a more precise approach by examining the unpacking code itself.</p>

<p>This means that we first need to reverse the binary statically and determine exactly where we should look. In most cases, you will find a shellcode for analysis. You can identify it by following the code flow until you encounter an indirect jump, a function pointer call in the decompiler view, or something like <code class="language-plaintext highlighter-rouge">jump rax</code> or <code class="language-plaintext highlighter-rouge">call rax</code> in the disassembler, it will not be always that easy but for in general if you are not dealing with code obfuscation that is the way to go.</p>

<p>So, our steps for a successful unpacking will be as follows:</p>

<ol>
  <li>Locate where the shellcode will be executed.</li>
  <li>Dump the raw shellcode.</li>
  <li>Reconstruct the code inside IDA, define struct types, and understand what the code does.</li>
  <li>Repeat the previous step for each stage of the unpacking process.</li>
  <li>Fully recover the final binary.</li>
</ol>

<p><a href="/assets/images/unpacking_redline/ed.gif" class="popup img-link "><img data-src="/assets/images/unpacking_redline/ed.gif" alt="" class="lazyload" data-proofer-ignore></a></p>

<p>With that in mind, let’s get started!</p>

<h2 id="finding-where-to-stop"><span class="mr-2">Finding where to stop</span><a href="#finding-where-to-stop" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/mainstage1.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/mainstage1.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.1 Dead code and dummy code to distract analysis</td>
    </tr>
  </tbody>
</table></div>

<p>This sample employs a lot of junk and unused functions. At first glance in (1), we can see that we are looking at functions that have no use at all. It’s common for malware to use obfuscators that insert dummy code flows and function calls.</p>

<p>Also, note that in (2), some pointers are filled with data that is responsible for:</p>

<ul>
  <li>uBytes: the amount of bytes needed to allocate the shellcode memory</li>
  <li>suspicious: the shellcode information struct, which we will talk about later.</li>
</ul>

<p>The juicy part is at sub_403340 (<code class="language-plaintext highlighter-rouge">executeHiddenCode</code>). Let’s dive in and search for any function pointer calls.</p>

<h3 id="function-pointers"><span class="mr-2">Function pointers</span><a href="#function-pointers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/first_function_ptr_call.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/first_function_ptr_call.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.2 Function pointer call at the end</td>
    </tr>
  </tbody>
</table></div>

<p>At the end of the function, it’s possible to see a call to a function pointer <code class="language-plaintext highlighter-rouge">SomeHiddenFunction</code> (<code class="language-plaintext highlighter-rouge">dword_4B6B98</code>). As it turns out, this memory region is allocated at runtime, and it’s fairly easy to find where using the xrefs:</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/someHiddenFunctionAssign.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/someHiddenFunctionAssign.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.3 shows the memory assignment on the suspicious function pointer.</td>
    </tr>
  </tbody>
</table></div>

<p>Looking at the references to this memory area, it’s pretty clear that we should at least look at the only place where there is an assignment to this memory area: <code class="language-plaintext highlighter-rouge">mov SomeHiddenFunction, eax</code>. From there, it’s possible to follow the code flow to understand how this function is built.</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/functionLocalAlloc.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/functionLocalAlloc.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.4 Function memory allocation.</td>
    </tr>
  </tbody>
</table></div>

<p>Indeed, the function is being allocated at runtime by using the LocalAlloc function. By looking at the xrefs to this allocation function, it’s possible to identify that the <code class="language-plaintext highlighter-rouge">executeHiddenFunction</code> is responsible for calling it.</p>

<p>Later on, the memory area permissions are changed dynamically to allow code execution using the <code class="language-plaintext highlighter-rouge">VirtualProtect</code> function:</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/virtualprotect.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/virtualprotect.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.5 Dynamic invocation of VirtualProtect to change memory permissions for shellcode execution</td>
    </tr>
  </tbody>
</table></div>

<h3 id="shellcode-structure"><span class="mr-2">Shellcode structure</span><a href="#shellcode-structure" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Do you recall the suspicious variable mentioned earlier? It’s actually used as a trick to hide the real encrypted shellcode offset. The trick involves pointing to an invalid memory area and then adding a fixed value of 732475 to it, which ultimately points to the real shellcode blob array address.</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/partOfMem.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/partOfMem.png" alt="" class="lazyload" data-proofer-ignore></a></th>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/copyingShellcode.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/copyingShellcode.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.6 Address pointed by the <code class="language-plaintext highlighter-rouge">suspicious</code> pointer</td>
      <td style="text-align: center">Fig.7 Address fixed and copying shellcode blob</td>
    </tr>
  </tbody>
</table></div>

<p>In other words, the actual address of the shellcode starts at <code class="language-plaintext highlighter-rouge">0x35FAD5 + 732475 = 0x412810</code>.</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/shellcodeBlob.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/shellcodeBlob.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.8 Shellcode encrypted blob start</td>
    </tr>
  </tbody>
</table></div>

<p>In my first analysis, I did not pay much attention to the encryption scheme used in this code, as I was able to easily dump the shellcode inside x64dbg by breaking at the <code class="language-plaintext highlighter-rouge">SomeHiddenFunction</code> call. However, after reading the article by <a href="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/">Fumik0</a> which analyzes a similar packer, I realized that the encryption scheme used here is the same as in the other packer: the Tiny Encryption Algorithm <a href="https://en.wikipedia.org/wiki/Tiny_Encryption_Algorithm">TEA</a> (Tiny Encryption Algorithm).</p>

<p>TEA is a symmetric key block cipher with a block size of 64 bits, which was designed to be simple and easy to implement. It uses a 128-bit key to encrypt data in 64-bit blocks, and the same key is used for decryption</p>

<p>I’m not a cryptography expert so I can’t dive to much on this part, but here is where the decryption really happens:</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/DecryptWrapper.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/DecryptWrapper.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.9 Decrypt prepare and wrapper</td>
    </tr>
  </tbody>
</table></div>

<p>Due to the large amount of junk code and dummy function calls in the binary, I’ve highlighted only the real decryption code. With the decryption key properly set, the algorithm is able to decrypt the shellcode and execute it in memory.</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/tie_algo.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/tie_algo.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.10 TEA algorithm core</td>
    </tr>
  </tbody>
</table></div>

<h3 id="dumping-the-first-shellcode"><span class="mr-2">Dumping the first shellcode</span><a href="#dumping-the-first-shellcode" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>As we have a good understand of the first shellcode stage of this loader, we can already dump it using x64dbg.</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/saving_shellcode.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/saving_shellcode.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.10 Dumping the first shellcode stage</td>
    </tr>
  </tbody>
</table></div>

<p>After triggering the breakpoint at call eax in someHiddenFunction(), we can navigate to where eax points on the dump tab and save the contents to a file. This will allow us to dump the first stage shellcode.</p>

<p><a href="/assets/images/unpacking_redline/manual_unpack_meme.jpg" class="popup img-link "><img data-src="/assets/images/unpacking_redline/manual_unpack_meme.jpg" alt="" class="lazyload" data-proofer-ignore></a></p>

<h1 id="shellcode-analysis---stage1">Shellcode Analysis - Stage1</h1>

<p>The first stage shellcode is responsible for dynamically loading functions such as GetProcAddress and LoadLibraryA by parsing the Process Environment Block (PEB). It also uses API hashing to locate the DLL name and function name.</p>

<p>To analyze the shellcode in IDA Pro, we need to load the necessary type libraries first. Here’s how to do it:</p>

<ul>
  <li>Open IDA Pro and load the target binary.</li>
  <li>Go to “View” -&gt; “Sub views” -&gt; “Type libraries” or just Hit <code class="language-plaintext highlighter-rouge">Shift + F11</code></li>
  <li>Load the <code class="language-plaintext highlighter-rouge">mssdk64_win10</code> and click “OK”</li>
</ul>

<p>To enhance your analysis, it is recommended to include the complete definitions of the <code class="language-plaintext highlighter-rouge">PEB</code> and <code class="language-plaintext highlighter-rouge">_LDR_DATA_TABLE_ENTRY</code> structures. You can quickly achieve this by importing the definitions from the <a href="https://raw.githubusercontent.com/x64dbg/x64dbg/18b949ee51a634bf5fff3ee717a765ba136cb791/src/dbg/ntdll/ntdll.h">ntdll.h</a> file available in the <a href="https://github.com/x64dbg/x64dbg">x64dbg</a> repository. Simply copy the content of ntdll.h as a local type in IDA Pro by using the shortcut <code class="language-plaintext highlighter-rouge">Shift+F1</code> &gt; right click &gt; insert &gt; Ok, you will get some errors but that’s fine because you mostly will have a lot of structs in the local types view, mark everything with <code class="language-plaintext highlighter-rouge">Ctrl+A</code> and select “Synchronize to idb”.</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/syncing_localtypes.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/syncing_localtypes.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.11 Including local types</td>
    </tr>
  </tbody>
</table></div>

<h2 id="reversing-the-api-resolver-routine"><span class="mr-2">Reversing the API resolver routine</span><a href="#reversing-the-api-resolver-routine" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>When the shellcode is opened in the decompiler view, several interesting things can be observed:</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/resolveCodeWithoutReverse.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/resolveCodeWithoutReverse.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.12 Shellcode without further reversing</td>
    </tr>
  </tbody>
</table></div>

<ul>
  <li>A suspicious function that takes two parameters that looks like a checksum/hash</li>
  <li>An incremented and assigned pointer (a1)</li>
  <li>A large number of API function names</li>
  <li>The same pointer (a1) being accessed and called over and over</li>
</ul>

<p>From this information, it can be deduced that:</p>

<ul>
  <li>A1 is likely a struct</li>
  <li>The <code class="language-plaintext highlighter-rouge">sub_83</code> function probably performs some API hashing routine</li>
  <li>The functions are likely loaded using GetProcAddress</li>
</ul>

<p>The supposed API hashing function contains the following code without analysis:</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/resolvefunction_raw.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/resolvefunction_raw.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.13 Raw code from the supposed API hashing function</td>
    </tr>
  </tbody>
</table></div>

<p>Upon inspection of the code, it becomes evident that the <code class="language-plaintext highlighter-rouge">InLoadOrderModuleList</code> structure inside the PEB is being accessed. This structure represents a doubly linked list that stores the loaded modules of a process in the order they were loaded. Each element of the linked list is an <code class="language-plaintext highlighter-rouge">LDR_DATA_TABLE_ENTRY</code> structure, which contains useful information about the module such as its DLL name, base address, and other attributes.</p>

<p>In addition, the code contains a few unresolved variables, which is a common occurrence when analyzing shellcode. To ensure precision, it is advisable to follow both the decompiler and disassembly views while rebuilding the code.</p>

<p>This will enable us to redefine the structures accurately and produce a more comprehensive understanding of the code’s functionality.</p>

<h2 id="rebuilding-structs-from-the-assembly-view"><span class="mr-2">Rebuilding structs from the assembly view</span><a href="#rebuilding-structs-from-the-assembly-view" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/PEBAccess.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/PEBAccess.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.14 PEB access from the assembly view</td>
    </tr>
  </tbody>
</table></div>

<p>In the assembly code, it’s possible to see that the PEB address is being pushed into the stack and poped in <code class="language-plaintext highlighter-rouge">eax</code>, later on <code class="language-plaintext highlighter-rouge">eax</code> is incremented to <code class="language-plaintext highlighter-rouge">0xC</code>, with this we can start to rebuild the structures by marking the <code class="language-plaintext highlighter-rouge">register+offset</code> and pressed <code class="language-plaintext highlighter-rouge">T</code>, which allows us to search for each struct that match to that offset access:</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/rebuildStructAssembly.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/rebuildStructAssembly.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.15 Rebuild structs from the assembly view</td>
    </tr>
  </tbody>
</table></div>

<p>When rebuilding a shellcode, it’s important to ensure that you have all the necessary structs for the PE file and that they have the correct architecture. If you have already imported the type libraries, you can easily add the required structs by going to the ‘Structure’ tab, right-clicking and selecting ‘Add struct type’, and searching for the struct. In the case of a 32-bit shellcode, the following structs will be needed:</p>

<ul>
  <li>IMAGE_DOS_HEADER</li>
  <li>IMAGE_NT_HEADERS32</li>
  <li>IMAGE_OPTIONAL_HEADERS32</li>
  <li>IMAGE_EXPORT_DIRECTORY</li>
  <li>IMAGE_DATA_DIRECTORY</li>
</ul>

<p>The retyped assembly code looks like:</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/retyped_assembly.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/retyped_assembly.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.16 PEB parsing code retyped in the assembly view</td>
    </tr>
  </tbody>
</table></div>

<p>From the code, it’s clear that the shellcode is parsing each loaded module, retrieving its name and sending it to a function with the first parameter (checksum1). If the checksum matches, it proceeds to parse the in-memory PE file to retrieve the export table information. Knowing this, we can apply the same types in the decompiler view to understand the code better. However, it’s important to note that some of the decompiler code may be broken, so it’s best to cross-check with the disassembly view:</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/decompiledcode_shellcode1_resolve.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/decompiledcode_shellcode1_resolve.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.17 Decompiled code of the resolver</td>
    </tr>
  </tbody>
</table></div>

<p>Great! So the resolving function utilizes the first parameter as a checksum to match the DLL name, and the second parameter for the exported function name. The checksum code itself is relatively simple. However, in order to determine which DLL and exported function is being searched, one would have to run the checksum code against all common Windows DLL files and their exported functions.</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/checksumcode.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/checksumcode.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.18 String checksum code</td>
    </tr>
  </tbody>
</table></div>

<h2 id="discovering-api-hashing-values-using-hashdb"><span class="mr-2">Discovering API hashing values using HashDB</span><a href="#discovering-api-hashing-values-using-hashdb" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Luckly for us there is an open-source project called <a href="https://hashdb.openanalysis.net/">HashDB</a> that has already done the heavy lifting for us. It includes a collection of known API hashing algorithms and their respective values. In addition, there is an <a href="https://github.com/OALabs/hashdb-ida">IDA Pro plugin</a> available to assist with this task. If you are interested in learning more about it, check out this <a href="https://www.youtube.com/watch?v=3FPY4cLaELU">video</a>.</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/matched_algorithm_hashdb.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/matched_algorithm_hashdb.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.19 Matched algorithms using hashDB</td>
    </tr>
  </tbody>
</table></div>

<p>I’ve choosen the <code class="language-plaintext highlighter-rouge">shl1_add</code> because this is not revil, but other algorithms may work as well (perhaps they use the same calculation). With knowledge of the algorithm, we can search for its values and determine that this checksum corresponds to the kernel32.dll module.</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"> </th>
      <th><a href="/assets/images/unpacking_redline/matched_hash.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/matched_hash.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.20 DLL match</td>
      <td> </td>
    </tr>
  </tbody>
</table></div>

<p>Actually, there was a hash collision with the first argument, but if you open this dropdown you will find the KERNEL32.DLL in uppercase and other non-native libraries, so it must be kernel32. Repeating the same process for the second argument will reveal that it is the LoadLibraryA function!</p>

<p>Now a cool feature of HashDB is that if there is a hit on a function name from a specific module, it can download ALL the hash values from that DLL for us and create an enum in the local types views. This enum can be used to automatically resolve everything at once, saving us time and effort.</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/bulk_import.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/bulk_import.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.21 HashDB bulk import</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/hashdb_enum.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/hashdb_enum.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.22 HashDB created enum</td>
    </tr>
  </tbody>
</table></div>

<p>Now with all this information collected, we can change the function signature and automatically the names will be associeted to the hash values:</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/changingFunctionDeclaration.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/changingFunctionDeclaration.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.23 Changing the function signature</td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/discovered_resolved_names.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/discovered_resolved_names.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.24 Resolved names discovered!</td>
    </tr>
  </tbody>
</table></div>

<h2 id="rebuilding-the-shellcode-struct"><span class="mr-2">Rebuilding the Shellcode struct</span><a href="#rebuilding-the-shellcode-struct" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Perfect, now that we already know what functions are being resolved we can proceed, the next step is to rebuild the <code class="language-plaintext highlighter-rouge">a1</code> struct, this is likely the Shellcode struct that hold every important informationl in order to work. It’s pretty easy to create a struct if there are being have access to this pointer, just right click the <code class="language-plaintext highlighter-rouge">a1</code> variable and hit create a new struct type</p>

<p>Great! Now that we have identified what functions are being resolved we can proceed create a new struct definition for the <code class="language-plaintext highlighter-rouge">a1</code> pointer. To create a new struct definition, simply right-click on the <code class="language-plaintext highlighter-rouge">a1</code> variable, hit <code class="language-plaintext highlighter-rouge">create a new struct type</code>.</p>

<p>Make sure to include all the necessary fields and data types based on the information we have gathered so far. Once the struct definition is created, you can use it to reference the fields of the a1 struct and understand the overall structure of the shellcode.</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/ResolveFunctionsReversed.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/ResolveFunctionsReversed.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.25 Shellcode struct rebuilded</td>
    </tr>
  </tbody>
</table></div>

<p>So, by rebuilding the shellcode struct, we can see that it contains all the necessary functions required for its proper functioning. With this information, we can now exit the function and move on to the next steps with a newly created struct type!</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/shellcodeStruct.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/shellcodeStruct.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.26 Shellcode definition</td>
    </tr>
  </tbody>
</table></div>

<h2 id="the-path-to-the-last-stage"><span class="mr-2">The path to the last stage</span><a href="#the-path-to-the-last-stage" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Having access to the struct allows for replacement of all occurrences that use this structure. Once the API names have been resolved, a final function is executed to decrypt the next-stage shellcode and the actual packed PE file.</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/function_without_signature_replace.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/function_without_signature_replace.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.27 Function without signature</td>
    </tr>
  </tbody>
</table></div>

<p>As an example, consider this function that takes the previously discovered shellcode struct. Although the code may appear difficult to read, we can simply replace the function signature to expect a ShellcodeStruct parameter, which will clarify the code:</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/function_with_signature_replaced.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/function_with_signature_replaced.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.28 Signature fixed and cleaned code</td>
    </tr>
  </tbody>
</table></div>

<p>Now it is clear what will happen. The function will use CreateToolHelp32Snapshot to capture information about all loaded modules, but will only select the first one. However, upon closer examination, it becomes apparent that this is a decoy code since none of this information will be used.</p>

<p>Instead, the DecryptAndExec function will allocate memory for the next stage, decrypt it and execute a direct jump to this area.</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/execute_next_stage.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/execute_next_stage.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.29 Final function in the first stage loader</td>
    </tr>
  </tbody>
</table></div>

<p>The DecryptAndExec function is a crucial component of the shellcode execution, this function accesses certain members of the ShellCodeStruct, but these are not relevant to our current analysis.</p>

<p>The function then proceeds to allocate memory using the <code class="language-plaintext highlighter-rouge">VirtualAlloc</code> function, with the memory location being stored in the pNextStage pointer. This memory area will be used to hold the decrypted and copied next stage of the malware.</p>

<p>With this knowledge of when the next stage will be executed, we can continue our analysis in x64dbg. By creating a signature for the <code class="language-plaintext highlighter-rouge">jmp</code> instruction inside the shellcode, we can place a breakpoint before the dump of the second stage. This will enable us to analyze the second stage of the malware’s execution and gain further insight into the capabilities and behavior of the malware.</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/jmp_signature.png" class="popup img-link "><img data-src="/assets/images/unpacking_redline/jmp_signature.png" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.30 jump pattern signature to be used in debugger pattern scanning.</td>
    </tr>
  </tbody>
</table></div>

<h1 id="dumping-the-last-stage">Dumping the last stage</h1>

<p>By applying the pattern <code class="language-plaintext highlighter-rouge">8B 45 08 8B 40 04 8B 4D F4 89 08 FF 65 FC</code> we will be able to find the <code class="language-plaintext highlighter-rouge">jmp</code> instruction showed earlier and also dump this second stage shellcode:</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/last_stage_dump.gif" class="popup img-link "><img data-src="/assets/images/unpacking_redline/last_stage_dump.gif" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.31 Dumping the last stage using the jump signature</td>
    </tr>
  </tbody>
</table></div>

<p>Perfect! Now, let me share a helpful tip to speed up the analysis process. As mentioned earlier, the final stage of the shellcode typically contains the unpacked PE file. Rather than dumping the entire memory content, it’s possible to extract only the PE file from the memory dump. This can save a considerable amount of time and resources:</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center"><a href="/assets/images/unpacking_redline/dumping_pe.gif" class="popup img-link "><img data-src="/assets/images/unpacking_redline/dumping_pe.gif" alt="" class="lazyload" data-proofer-ignore></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Fig.34 Dumping the PE file that resides in the last stage</td>
    </tr>
  </tbody>
</table></div>

<p><strong><em>Spoiler Alert: We’ve successfully unpacked the final stage!</em></strong></p>

<p>The last shellcode is responsible for manually mapping the PE file, importing all the dependencies, and jumping to the entry point. Once the PE file is unpacked, one can continue the analysis without wasting time with the packer.</p>

<h1 id="conclusion">Conclusion</h1>

<p>To sum it up, this article aimed to show a more professional and accurate manual unpacking method instead of relying on luck and common API breakpoints to find a PE file. While this packer was simple, other cases may not be so straightforward, such as when the MZ header is missing or there’s no PE file at all. However, this fundamental knowledge is still valuable.</p>

<p>I’m thrilled to be back writing for the blog and look forward to publishing more articles, not only on malware reversing.</p>

<p><a href="/assets/images/unpacking_redline/parabains.gif" class="popup img-link "><img data-src="/assets/images/unpacking_redline/parabains.gif" alt="" class="lazyload" data-proofer-ignore></a></p>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  
  <div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i>
    
      <a href='/categories/reverse-engineering/'>Reverse-Engineering</a>
  </div>
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i>
      
      <a href="/tags/reverse-engineering/"
          class="post-tag no-text-decoration" >Reverse Engineering</a>
      
      <a href="/tags/malware-research/"
          class="post-tag no-text-decoration" >Malware Research</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.

      
    </div>

    <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=Manual%20Unpacking%20in%20Details%20-%20Reversing%20codes&url=https%3A%2F%2Freversing.codes%2Fposts%2FManual-unpacking-in-details%2F" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=Manual%20Unpacking%20in%20Details%20-%20Reversing%20codes&u=https%3A%2F%2Freversing.codes%2Fposts%2FManual-unpacking-in-details%2F" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://t.me/share/url?url=https%3A%2F%2Freversing.codes%2Fposts%2FManual-unpacking-in-details%2F&text=Manual%20Unpacking%20in%20Details%20-%20Reversing%20codes" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="Copy link"
        data-title-succeed="Link copied successfully!">
    </i>

  </span>
</div>


  </div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->


      
    
    

    </div>
  </div> <!-- #core-wrapper -->

  <!-- panel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted">

    <div class="access">
      















  <div id="access-lastmod" class="post">
    <div class="panel-heading">Recently Updated</div>
    <ul class="post-content pl-0 pb-1 ml-1 mt-2">
      
        
        
        
      <li><a href="/posts/PlayStation-5-ELF-Injection/">Usermode ELF injection on the PlayStation 5</a></li>
      
        
        
        
      <li><a href="/posts/ps4-kernel-patching-guide/">How to patch the running PlayStation 4 kernel</a></li>
      
        
        
        
      <li><a href="/posts/Stop-Using-GetProcAddress-And-Let-The-Linker/">Quick Tip: Stop Using GetProcAddress and Let the Linker Do the Job for You</a></li>
      
        
        
        
      <li><a href="/posts/Manual-unpacking-in-details/">Manual Unpacking in Details</a></li>
      
        
        
        
      <li><a href="/posts/Manipulating-elf-with-felf/">Manipulating elf files in C++ using felf</a></li>
      
    </ul>
  </div> <!-- #access-lastmod -->



      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/programming/">Programming</a>
    
      
      <a class="post-tag" href="/tags/reverse-engineering/">Reverse engineering</a>
    
      
      <a class="post-tag" href="/tags/malware-research/">Malware Research</a>
    
      
      <a class="post-tag" href="/tags/ctf/">ctf</a>
    
      
      <a class="post-tag" href="/tags/windows-internals/">Windows Internals</a>
    
      
      <a class="post-tag" href="/tags/freebsd/">FreeBSD</a>
    
      
      <a class="post-tag" href="/tags/malware-analysis/">Malware analysis</a>
    
      
      <a class="post-tag" href="/tags/malware-research/">Malware research</a>
    
      
      <a class="post-tag" href="/tags/network-analysis/">Network analysis</a>
    
      
      <a class="post-tag" href="/tags/obfuscation-analysis/">obfuscation analysis</a>
    

    </div>
  </div>


    </div>

    
      
      



  <div id="toc-wrapper" class="pl-0 pr-4 mb-5">
    <div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
    <nav id="toc"></nav>
  </div>

  <!-- toc.js will be loaded at medium priority -->
  <script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script>


    
  </div>

</div>

<!-- tail -->

<div class="row">
  <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5">
    
      
      <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->





  <div id="related-posts" class="mb-2 mb-sm-4">
    <h3 class="pt-2 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/bipartite-graph-for-threats/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1588289496"
    data-df="ll"
    >
  Apr 30, 2020
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Using bipartite Graphs to detect Malware campaigns</h3>
            <div class="text-muted small">
              <p>
                





                One of the greatest problems in mapping threats today, is detect from where it’s came, if is from the same group, same person or even from the same governament.

In order to group everything up and...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/Detecting-injected-code-with-page-guards/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1689083520"
    data-df="ll"
    >
  Jul 11, 2023
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Designing a Malware Loader detector with Guard Violation Exceptions</h3>
            <div class="text-muted small">
              <p>
                





                Recently, I made the decision to finally publish my tool focused on unpacking, called Shinigami. The idea for Shinigami came to me two years ago, but I never actually implemented it until now. Init...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/Code-it-flare-7/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1603495416"
    data-df="ll"
    >
  Oct 23, 2020
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>The Flare 7th AutoIT challenge</h3>
            <div class="text-muted small">
              <p>
                





                The 7th challenge of Flare-On CTF, give to us a QR code generator software that are fully obfuscated, the fun part of this challenge was interpret, analyse and deobfuscate core components of the so...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->


    
      
      <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/Manipulating-elf-with-felf/" class="btn btn-outline-primary"
    prompt="Older">
    <p>Manipulating elf files in C++ using felf</p>
  </a>
  

  
  <a href="/posts/Detecting-injected-code-with-page-guards/" class="btn btn-outline-primary"
    prompt="Newer">
    <p>Designing a Malware Loader detector with Guard Violation Exceptions</p>
  </a>
  

</div>

    
      
      <!--  The comments switcher -->


    
  </div>
</div>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/programming/">Programming</a>
    
      
      <a class="post-tag" href="/tags/reverse-engineering/">Reverse engineering</a>
    
      
      <a class="post-tag" href="/tags/malware-research/">Malware Research</a>
    
      
      <a class="post-tag" href="/tags/ctf/">ctf</a>
    
      
      <a class="post-tag" href="/tags/windows-internals/">Windows Internals</a>
    
      
      <a class="post-tag" href="/tags/freebsd/">FreeBSD</a>
    
      
      <a class="post-tag" href="/tags/malware-analysis/">Malware analysis</a>
    
      
      <a class="post-tag" href="/tags/malware-research/">Malware research</a>
    
      
      <a class="post-tag" href="/tags/network-analysis/">Network analysis</a>
    
      
      <a class="post-tag" href="/tags/obfuscation-analysis/">obfuscation analysis</a>
    

    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    <!-- The Footer -->

<footer>
  <div class="container pl-lg-4 pr-lg-4">
    <div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3">
      <div class="footer-left">
        <p class="mb-0">
          © 2025
          <a href="https://github.com/buzzer-re">Buzzer</a>.
          
          <span data-toggle="tooltip" data-placement="top"
            title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
          
        </p>
      </div>

      <div class="footer-right">
        <p class="mb-0">Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>.
        </p>
      </div>
    </div>
  </div>
</footer>


    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    
      <div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true"
        data-animation="true" data-autohide="false">
        <div class="toast-header">
          <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="toast-body text-center pt-0">
          <p class="pl-2 pr-2 mb-3">A new version of content is available.</p>
          <button type="button" class="btn btn-primary" aria-label="Update">
            Update
          </button>
        </div>
      </div>
    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No results found.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!-- JS selector for site. -->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup & clipboard -->
  

  







  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js"></script>





  

  

  







  
    

    

  



  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1.11.6/dayjs.min.js,npm/dayjs@1.11.6/locale/en.min.js,npm/dayjs@1.11.6/plugin/relativeTime.min.js,npm/dayjs@1.11.6/plugin/localizedFormat.min.js"></script>







<script defer src="/assets/js/dist/post.min.js"></script>



<!-- commons -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>




  </body>

</html>

