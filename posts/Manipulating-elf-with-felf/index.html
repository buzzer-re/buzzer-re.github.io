<!DOCTYPE html>









<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en"
  
    data-mode="dark"
  
>

  <!-- The Head -->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  >

  
    

    
  

  

  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Manipulating elf files in C++ using felf" />
<meta property="og:locale" content="en" />
<meta name="description" content="A couple months ago I created felf, a library to parse ELF files into C++ structures, the reason for this was to have a way in C++ to work on ELF files using STL structures like vector, unordered maps and so on." />
<meta property="og:description" content="A couple months ago I created felf, a library to parse ELF files into C++ structures, the reason for this was to have a way in C++ to work on ELF files using STL structures like vector, unordered maps and so on." />
<link rel="canonical" href="https://reversing.codes/posts/Manipulating-elf-with-felf/" />
<meta property="og:url" content="https://reversing.codes/posts/Manipulating-elf-with-felf/" />
<meta property="og:site_name" content="Reversing codes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-11-30T15:00:36-03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Manipulating elf files in C++ using felf" />
<meta name="twitter:site" content="@buzz3r_" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-03-03T18:48:23-03:00","datePublished":"2020-11-30T15:00:36-03:00","description":"A couple months ago I created felf, a library to parse ELF files into C++ structures, the reason for this was to have a way in C++ to work on ELF files using STL structures like vector, unordered maps and so on.","headline":"Manipulating elf files in C++ using felf","mainEntityOfPage":{"@type":"WebPage","@id":"https://reversing.codes/posts/Manipulating-elf-with-felf/"},"url":"https://reversing.codes/posts/Manipulating-elf-with-felf/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>Manipulating elf files in C++ using felf | Reversing codes
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Reversing codes">
<meta name="application-name" content="Reversing codes">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/style.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js"></script>

  
</head>


  <body data-topbar-visible="true">

    <!--
  The Side Bar
-->
<style>
  body {
      text-align: justify;
  }
  </style>
  
<div id="sidebar" class="d-flex flex-column align-items-end">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" class="mx-auto">
        
          
          <img src="https://avatars.githubusercontent.com/u/22428720" alt="avatar" onerror="this.style.display='none'">
        
      </a>
    </div>

    <div class="site-title">
      <a href="/">Buzzer's blog</a>
    </div>
    <div class="site-subtitle font-italic">Security Researcher & Dreamer</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">

    

    
      

      
      <a href="https://github.com/buzzer-re" aria-label="github"
        
        
          
          target="_blank"
        

        

        rel="noopener">
        <i class="fab fa-github"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/buzz3r_" aria-label="twitter"
        
        
          
          target="_blank"
        

        

        rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        
        

        

        >
        <i class="fas fa-rss"></i>
      </a>
      

    

  </div> <!-- .sidebar-bottom -->

      <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-V8QSGFHYFB"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        id = 'G-V8QSGFHYFB'
        gtag('config', id);
    </script>
</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper">
  <div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4">
    <span id="breadcrumb">

    

    

      

        
          <span>
            <a href="/">
              Home
            </a>
          </span>

        

      

        

      

        

          
            <span>Manipulating elf files in C++ using felf</span>
          

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div id="main" class="container pl-xl-4 pr-xl-4">
        





<div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4">
    <div class="post pl-1 pr-1 pl-md-2 pr-md-2">

    

    
      
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->


<!-- images -->




  
  

  <!-- CDN URL -->
  

  <!-- Add image path -->
  

  
    
      
      
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
        <!-- add SVG placehoder -->
        
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  

  



<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    

    

  

  
  

  




<!-- return -->

<h1 data-toc-skip>Manipulating elf files in C++ using felf</h1>

<div class="post-meta text-muted">
    <!-- published date -->
    <span>
      Posted
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class=""
    data-ts="1606759236"
    data-df="ll"
    data-toggle="tooltip" data-placement="bottom">
  Nov 30, 2020
</em>

    </span>

    <!-- lastmod date -->
    
    <span>
      Updated
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class=""
    data-ts="1677880103"
    data-df="ll"
    data-toggle="tooltip" data-placement="bottom">
  Mar  3, 2023
</em>

    </span>
    

  

  <div class="d-flex justify-content-between">
    <!-- author(s) -->
    <span>
      

      By

      <em>
      
        <a href="https://github.com/buzzer-re">Buzzer</a>
      
      </em>
    </span>

    <div>
      <!-- page views -->
      

      <!-- read time -->
      <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="3393 words">
  <em>18 min</em> read</span>

    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <p>A couple months ago I created <a href="https://github.com/AandersonL/felf">felf</a>, a library to parse <a href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format">ELF</a> files into C++ structures, the reason for this was to have a way in C++ to work on ELF files using <a href="https://www.geeksforgeeks.org/the-c-standard-template-library-stl/">STL</a> structures like vector, unordered maps and so on.</p>

<p>For this reason I wanna explore what was built and why, and show to you all the possibilities of this tiny yet nice library.</p>

<h1 id="executable-files">Executable files</h1>

<h2 id="whats-this-"><span class="mr-2">What’s this ?</span><a href="#whats-this-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>An <strong><em>executable file</em></strong> is designed to pack all information of a software into a single file that your OS will read, and do all the dirty work of mapping it’s code into memory and allocating resources that your CPU will use to execute.</p>

<p>These files are part of your life, now more than ever. You can find them in your SmartTV, Videogames, IoT devices and Unix systems</p>

<p>The ELF format is mainly <strong><em>used on Linux machines</em></strong>  but it it’s not the only one that exists <a href="https://en.wikipedia.org/wiki/Portable_Executable">PE</a> is mainly used in Windows, <a href="https://en.wikipedia.org/wiki/Mach-O">Mach-o</a> is used in MacOS systems. Although this article and library will be <strong><em>focused on ELF and Linux machines</em></strong>, all the knowledge is the same that you need to work with PE and Mach-O files.</p>

<h2 id="from-disk-to-memory"><span class="mr-2">From disk to memory</span><a href="#from-disk-to-memory" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Imagine ELF files as a pre-fabricated home, the way the file is on disk contains almost the same structures that will be mapped in memory and the steps the OS has to follow to do so in a correct way.</p>

<p>The structure is the follow:</p>

<p><a href="/assets/images/felf/elf.png" class="popup img-link  shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 75% 75%'%3E%3C/svg%3E" data-src="/assets/images/felf/elf.png" alt="" height="75%" width="75%" class="lazyload" data-proofer-ignore></a></p>

<p>Everything is pretty straight forward:</p>

<ul>
  <li>A ELF header that holds the basic information of the file</li>
  <li>A program header table that describes each segment of code that will be mapped</li>
  <li>Sections that hold some data, like executable code, string table, symbol table and so on</li>
  <li>Section header which is a array like structure that holds information about a given section</li>
</ul>

<h1 id="elf-internal-structures">ELF Internal structures</h1>

<p>Each of these structures are defined in <strong><em>elf.h</em></strong> and if you run <strong><em>man elf</em></strong> you will get it’s full documentation. Let’s start by parsing in ELF header from disk (without loading anything in memory yet).</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="cp">#define EI_NIDENT 16
</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">e_ident</span><span class="p">[</span><span class="n">EI_NIDENT</span><span class="p">];</span>
    <span class="kt">uint16_t</span>      <span class="n">e_type</span><span class="p">;</span>
    <span class="kt">uint16_t</span>      <span class="n">e_machine</span><span class="p">;</span>
    <span class="kt">uint32_t</span>      <span class="n">e_version</span><span class="p">;</span>
    <span class="n">ElfN_Addr</span>     <span class="n">e_entry</span><span class="p">;</span>
    <span class="n">ElfN_Off</span>      <span class="n">e_phoff</span><span class="p">;</span>
    <span class="n">ElfN_Off</span>      <span class="n">e_shoff</span><span class="p">;</span>
    <span class="kt">uint32_t</span>      <span class="n">e_flags</span><span class="p">;</span>
    <span class="kt">uint16_t</span>      <span class="n">e_ehsize</span><span class="p">;</span>
    <span class="kt">uint16_t</span>      <span class="n">e_phentsize</span><span class="p">;</span>
    <span class="kt">uint16_t</span>      <span class="n">e_phnum</span><span class="p">;</span>
    <span class="kt">uint16_t</span>      <span class="n">e_shentsize</span><span class="p">;</span>
    <span class="kt">uint16_t</span>      <span class="n">e_shnum</span><span class="p">;</span>
    <span class="kt">uint16_t</span>      <span class="n">e_shstrndx</span><span class="p">;</span>
<span class="p">}</span> <span class="n">ElfN_Ehdr</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>This <code class="language-plaintext highlighter-rouge">struct</code> specifies a structure equivalent to the first bytes of the file. Notice that we have a <strong><em>N</em></strong> in the variable name that can be used with <strong><em>32</em></strong> or <strong><em>64</em></strong> bits depending the OS and the file itself, the ELF header size can be 52 bytes in 32-bit files and 64 bytes in 64-bits files, you can verify that by looking the structs sizes:</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;elf.h&gt;</span><span class="cp">
</span><span class="p">...</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"%d bytes</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Elf32_Ehdr</span><span class="p">));</span> <span class="c1">// 52 bytes</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"%d bytes</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Elf64_Ehdr</span><span class="p">));</span> <span class="c1">// 64 bytes</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="parsing-the-header-from-scratch"><span class="mr-2">Parsing the header from scratch</span><a href="#parsing-the-header-from-scratch" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>As my system currently is in 64 bits, I will first dump out the first 64 bytes of data from my disk and use <a href="https://github.com/AandersonL/BlobToChar">BlobToChar</a> to built a C array code with the header. With this dump I can load the header in my code and parse it quickly.</p>

<p>First 64 bytes (Header):</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>$ hexdump -C -n64 /usr/bin/ls                                                                                                   
00000000  7f 45 4c 46 02 01 01 00  00 00 00 00 00 00 00 00  |.ELF............|
00000010  03 00 3e 00 01 00 00 00  20 5b 00 00 00 00 00 00  |..&gt;..... [......|
00000020  40 00 00 00 00 00 00 00  b0 23 02 00 00 00 00 00  |@........#......|
00000030  00 00 00 00 40 00 38 00  0b 00 40 00 1b 00 1a 00  |....@.8...@.....|
00000040
</pre></td></tr></tbody></table></code></div></div>
<p>Dumping on disk:</p>
<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>$ dd if=/usr/bin/ls of=lselfheader bs=1 count=64                                                                           [130]
64+0 records in
64+0 records out
64 bytes copied, 0.000510657 s, 125 kB/s
</pre></td></tr></tbody></table></code></div></div>

<p>Load in code in C arrays:</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>$ BlobToChar --blobname lselfheader                                                                                             
unsigned char buff[] = {0x7f,0x45,0x4c,0x46,0x2,0x1,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x3,0x0,0x3e,0x0,0x1,0x0,0x0,0x0,0x20,0x5b,0x0,0x0,0x0,0x0,0x0,0x0,0x40,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xb0,0x23,0x2,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x40,0x0,0x38,0x0,0xb,0x0,0x40,0x0,0x1b,0x0,0x1a,0x0,};
unsigned int buff_size = 64;
</pre></td></tr></tbody></table></code></div></div>

<p>The parse code can be written as:</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;elf.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>
<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">buff</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x7f</span><span class="p">,</span><span class="mh">0x45</span><span class="p">,</span><span class="mh">0x4c</span><span class="p">,</span><span class="mh">0x46</span><span class="p">,</span><span class="mh">0x2</span><span class="p">,</span><span class="mh">0x1</span><span class="p">,</span><span class="mh">0x1</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x3</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x3e</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x1</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x20</span><span class="p">,</span><span class="mh">0x5b</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x40</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0xb0</span><span class="p">,</span><span class="mh">0x23</span><span class="p">,</span><span class="mh">0x2</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x40</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x38</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0xb</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x40</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x1b</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span><span class="mh">0x1a</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,};</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">buff_size</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">Elf64_Ehdr</span><span class="o">*</span> <span class="n">elfHeader</span> <span class="o">=</span> <span class="p">(</span><span class="n">Elf64_Ehdr</span><span class="o">*</span><span class="p">)</span> <span class="n">buff</span><span class="p">;</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"e_ident: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">elfHeader</span><span class="o">-&gt;</span><span class="n">e_ident</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>As structs are just aligned bytes in memory, we can use the struct <strong><em>Elf64_Ehdr</em></strong> to parse these raw bytes, with this we can access the elf header internal struct. In the above example I printed the <strong><em>e_indent</em></strong>, which is an array with some basic information on the file itself, stored in the first 16 bytes of the <strong><em>buf</em></strong> variable. The very first 4 bytes: <strong><em>0x7f,0x45,0x4c,0x46</em></strong> contains the ‘ELF’ string starting from the second position.</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="o">~</span> <span class="o">&gt;&gt;&gt;</span> <span class="p">.</span><span class="o">/</span><span class="n">parseheader</span>                                                                              
<span class="n">Magic</span><span class="o">:</span> <span class="n">ELF</span>
</pre></td></tr></tbody></table></code></div></div>
<p>Knowing that, we can now parse the whole file by reading the file itself and use the ELF structs to extract the executable data itself.</p>

<h2 id="example-patching-sections-names"><span class="mr-2">Example: Patching sections names</span><a href="#example-patching-sections-names" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Let’s make a cool example, let’s change the <strong><em>.text</em></strong> section name to another thing. This section holds all the executable code in the file.</p>

<p>In order to make that possible, we need to have access to the string table struct, which holds an array of strings with the <strong><em>0x00</em></strong> byte as delimiter.</p>

<p><a href="/assets/images/felf/string_table.png" class="popup img-link "><img data-src="/assets/images/felf/string_table.png" alt="" class="lazyload" data-proofer-ignore></a></p>

<p>As the string table is just one portion of data in the file, it’s defined as a normal section and the struct in x64 elf is:</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">uint32_t</span>   <span class="n">sh_name</span><span class="p">;</span>
    <span class="kt">uint32_t</span>   <span class="n">sh_type</span><span class="p">;</span>
    <span class="kt">uint64_t</span>   <span class="n">sh_flags</span><span class="p">;</span>
    <span class="n">Elf64_Addr</span> <span class="n">sh_addr</span><span class="p">;</span>
    <span class="n">Elf64_Off</span>  <span class="n">sh_offset</span><span class="p">;</span>
    <span class="kt">uint64_t</span>   <span class="n">sh_size</span><span class="p">;</span>
    <span class="kt">uint32_t</span>   <span class="n">sh_link</span><span class="p">;</span>
    <span class="kt">uint32_t</span>   <span class="n">sh_info</span><span class="p">;</span>
    <span class="kt">uint64_t</span>   <span class="n">sh_addralign</span><span class="p">;</span>
    <span class="kt">uint64_t</span>   <span class="n">sh_entsize</span><span class="p">;</span>
<span class="p">}</span> <span class="n">Elf64_Shdr</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>With this struct in our hands, we just need to get the index of the section name (<code class="language-plaintext highlighter-rouge">sh_name</code>) and change it to something else. Notice that if we want to make the name greater or less then the real one, we will have to resize this array and change all the sections and address information to maintain the file integrity, in order to make this simple as possible I will just change the <strong><em>.text</em></strong> name to <strong><em>.etxt</em></strong>.</p>

<h3 id="loading-the-entire-file-in-memory"><span class="mr-2">Loading the entire file in memory</span><a href="#loading-the-entire-file-in-memory" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Before we continue, let’s make some real code for this task and for that we need to load the file data in our memory, just like a loader would.</p>

<p>To map files in memory in Linux, we will use the function <a href="https://www.man7.org/linux/man-pages/man2/mmap.2.html">mmap</a> that will create a in <strong><em>memory mapping</em></strong> to a given <a href="https://en.wikipedia.org/wiki/File_descriptor">file descriptor</a>.</p>

<p>Function definition:</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre> <span class="cp">#include</span> <span class="cpf">&lt;sys/mman.h&gt;</span><span class="cp">
</span>
<span class="kt">void</span> <span class="o">*</span><span class="nf">mmap</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">prot</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">,</span> 
            <span class="kt">int</span> <span class="n">fildes</span><span class="p">,</span> <span class="kt">off_t</span> <span class="n">off</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Using this idea, take a look in the following code to load our ELF file and dump the header, we will use this piece of code for the example part:</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre></td><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;elf.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/mman.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
	
	<span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"Usage: %s &lt;elf_path&gt;</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">elf_path</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">file_fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">elf_path</span><span class="p">,</span> <span class="n">O_RDWR</span><span class="p">);</span> <span class="c1">// Open in read and write</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">file_fd</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	
	<span class="k">struct</span> <span class="n">stat</span> <span class="n">st</span><span class="p">;</span> <span class="c1">// Get file size using stat function</span>
	<span class="n">stat</span><span class="p">(</span><span class="n">elf_path</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">st</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="n">file_size</span> <span class="o">=</span> <span class="n">st</span><span class="p">.</span><span class="n">st_size</span><span class="p">;</span>

	<span class="c1">// Map the current file descritor in any address in ours memory maps with size &lt;file_size&gt;</span>
	<span class="kt">void</span><span class="o">*</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">mmap</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">file_size</span><span class="p">,</span> <span class="n">O_RDWR</span><span class="p">,</span> <span class="n">MAP_SHARED</span><span class="p">,</span> <span class="n">file_fd</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">addr</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		
	
	<span class="c1">// Now we can work the new memory space using the raw address</span>

	<span class="n">Elf64_Ehdr</span><span class="o">*</span> <span class="n">elf_header</span> <span class="o">=</span> <span class="p">(</span><span class="n">Elf64_Ehdr</span><span class="o">*</span><span class="p">)</span> <span class="n">addr</span><span class="p">;</span>

	<span class="n">puts</span><span class="p">(</span><span class="s">"elf-&gt;e_indent: "</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">EI_NIDENT</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">0x%x(%c)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">elf_header</span><span class="o">-&gt;</span><span class="n">e_ident</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">elf_header</span><span class="o">-&gt;</span><span class="n">e_ident</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>

	<span class="c1">// Unmap the values	</span>
	<span class="n">munmap</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span><span class="n">file_size</span><span class="p">);</span>

	<span class="c1">// Close the file descriptor</span>
	<span class="n">close</span><span class="p">(</span><span class="n">file_fd</span><span class="p">);</span>


	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>If you compile the code above, you will get something like:</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>elf-&gt;e_indent: 
	0x7f()
	0x45(E)
	0x4c(L)
	0x46(F)
	0x2()
    ...
</pre></td></tr></tbody></table></code></div></div>

<h3 id="finding-the-section-string-table"><span class="mr-2">Finding the section string table</span><a href="#finding-the-section-string-table" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Ok, now let’s start the real job to get the section named <strong><em>.text</em></strong>. In order to accomplish that we need the first entry in the <strong>section array</strong> structure and get the total bytes used by this array, all this information can be found in the following field of the <strong>elf header</strong>:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">e_shnum</code> - Holds the number of sections that our ELF file has</li>
  <li><code class="language-plaintext highlighter-rouge">e_shentsize</code> - Holds the total raw size of each section</li>
  <li><code class="language-plaintext highlighter-rouge">e_shoff</code> - Holds the offset of the first entry in the array</li>
</ul>

<p>Knowing all that, we can calculate where the section array starts by getting the address of the mapped file + the <strong><em>e_shoff</em></strong> and then create a <code class="language-plaintext highlighter-rouge">for</code> loop where each “jump” is the index * <code class="language-plaintext highlighter-rouge">e_shentsize</code>, that way we can jump in each element of the array, after reaching the .text section we can get where in the string table it’s name is defined.</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="n">Elf64_Ehdr</span><span class="o">*</span> <span class="n">elf_header</span> <span class="o">=</span> <span class="p">(</span><span class="n">Elf64_Ehdr</span><span class="o">*</span><span class="p">)</span> <span class="n">addr</span><span class="p">;</span>
<span class="kt">uint16_t</span> <span class="n">num_sections</span> <span class="o">=</span> <span class="n">elf_header</span><span class="o">-&gt;</span><span class="n">e_shnum</span><span class="p">;</span>
<span class="kt">uint16_t</span> <span class="n">section_size</span> <span class="o">=</span> <span class="n">elf_header</span><span class="o">-&gt;</span><span class="n">e_shentsize</span><span class="p">;</span>
<span class="n">Elf64_Off</span> <span class="n">section_entry_offset</span> <span class="o">=</span> <span class="n">elf_header</span><span class="o">-&gt;</span><span class="n">e_shoff</span><span class="p">;</span>

<span class="n">printf</span><span class="p">(</span><span class="s">"%d Sections, with %d bytes each and starting at address 0x%x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">num_sections</span><span class="p">,</span> <span class="n">section_size</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint64_t</span><span class="p">)</span> <span class="n">addr</span> <span class="o">+</span> <span class="n">section_entry_offset</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<blockquote>
  <p>25 Sections, with 64 bytes each and starting at address 0x82702f68</p>
</blockquote>

<p>Your numbers might differ based in the file that are you using and the mapped address that is used to calculate the entry of the array.</p>

<p>Now, we need to find the string table that will be used as an array, lucky for us, the index string table in the section array is easily found in the ELF header, in the field <strong><em>e_shstrndx</em></strong>, to find the address using this index we just need to get the address of the first entry in the array and multiple the index with the size of each section.</p>

<p>pseudo-code:</p>
<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>string_table_address = (index * section_size) + first_entry_address
or
string_table_address = section_size + section
</pre></td></tr></tbody></table></code></div></div>
<p>Or even better, we can just get the first section address and just add the <strong><em>section_size</em></strong>, if you are familiar in how an array really works in memory, this will be easy to understand.</p>

<p>C code:</p>
<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">Elf64_Shdr</span><span class="o">*</span> <span class="n">string_table_section</span> <span class="o">=</span> <span class="p">(</span><span class="n">Elf64_Shdr</span><span class="o">*</span><span class="p">)</span> <span class="p">(</span> <span class="p">(</span><span class="kt">uint64_t</span><span class="p">)</span> <span class="n">section</span> <span class="o">+</span> <span class="p">((</span><span class="kt">uint64_t</span><span class="p">)</span> <span class="n">section_size</span> <span class="o">*</span> <span class="n">elf_header</span><span class="o">-&gt;</span><span class="n">e_shstrndx</span><span class="p">));</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="finding-the-text-string-index"><span class="mr-2">Finding the .text string index</span><a href="#finding-the-text-string-index" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>Now with the section header loaded, we can find the offset where the section data is stored, as this is only the header and the real content is in another place in the file, this data location is found in the field <strong><em>sh_offset</em></strong> in the section header, so in order to find the array we just need to get the <strong><em>mapped file address + section-&gt;sh_offset</em></strong>.</p>

<p>After find the raw data in the file we just need to work how it’s is specified in the ELF specs, this is a normal C-String array with the <strong><em>\00</em></strong> as delimiter.</p>

<p>C code to find the first entry in string table:</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">section_name</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span> <span class="p">((</span> <span class="p">(</span><span class="kt">uint64_t</span><span class="p">)</span> <span class="n">string_table_section</span><span class="o">-&gt;</span><span class="n">sh_offset</span> <span class="o">+</span> <span class="n">addr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<p>This will access the string array and get the first element, in order to pick the sections name we need access the field <strong><em>sh_name</em></strong> in the section header that holds the name index of this section in the string array, using that we can iterate in each section of the file and get each name easily, check the code:</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="n">Elf64_Shdr</span><span class="o">*</span> <span class="n">section</span> <span class="o">=</span> <span class="p">(</span><span class="n">Elf64_Shdr</span><span class="o">*</span><span class="p">)</span> <span class="p">((</span><span class="kt">uint64_t</span><span class="p">)</span> <span class="n">addr</span> <span class="o">+</span> <span class="n">section_entry_offset</span><span class="p">);</span>	
<span class="n">Elf64_Shdr</span><span class="o">*</span> <span class="n">string_table_section</span> <span class="o">=</span> <span class="p">(</span><span class="n">Elf64_Shdr</span><span class="o">*</span><span class="p">)</span> <span class="p">(</span> <span class="p">(</span><span class="kt">uint64_t</span><span class="p">)</span> <span class="n">section</span> <span class="o">+</span> <span class="p">((</span><span class="kt">uint64_t</span><span class="p">)</span> <span class="n">section_size</span> <span class="o">*</span> <span class="n">elf_header</span><span class="o">-&gt;</span><span class="n">e_shstrndx</span><span class="p">));</span>

<span class="kt">char</span><span class="o">*</span> <span class="n">section_name</span><span class="p">;</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num_sections</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">section</span> <span class="o">=</span> <span class="p">(</span><span class="n">Elf64_Shdr</span><span class="o">*</span><span class="p">)</span> <span class="p">((</span><span class="kt">uint64_t</span><span class="p">)</span> <span class="n">section</span> <span class="o">+</span> <span class="n">section_size</span><span class="p">);</span>
    <span class="n">section_name</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span> <span class="p">((</span> <span class="p">(</span><span class="kt">uint64_t</span><span class="p">)</span> <span class="n">string_table_section</span><span class="o">-&gt;</span><span class="n">sh_offset</span> <span class="o">+</span> <span class="n">addr</span><span class="p">)</span> <span class="o">+</span> <span class="n">section</span><span class="o">-&gt;</span><span class="n">sh_name</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="changing-the-text-name"><span class="mr-2">Changing the .text name</span><a href="#changing-the-text-name" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Now, it’s pretty simple, we can modify the name directly and as this file is mapped in memory in read-write mode our changes will be flushed directly in the disk file, take a look:</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num_sections</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">section</span> <span class="o">=</span> <span class="p">(</span><span class="n">Elf64_Shdr</span><span class="o">*</span><span class="p">)</span> <span class="p">((</span><span class="kt">uint64_t</span><span class="p">)</span> <span class="n">section</span> <span class="o">+</span> <span class="n">section_size</span><span class="p">);</span>
    <span class="n">section_name</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span> <span class="p">((</span> <span class="p">(</span><span class="kt">uint64_t</span><span class="p">)</span> <span class="n">string_table_section</span><span class="o">-&gt;</span><span class="n">sh_offset</span> <span class="o">+</span> <span class="n">addr</span><span class="p">)</span> <span class="o">+</span> <span class="n">section</span><span class="o">-&gt;</span><span class="n">sh_name</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">section_name</span><span class="p">,</span> <span class="s">".text"</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">strcpy</span><span class="p">(</span><span class="n">section_name</span><span class="p">,</span> <span class="s">".txet"</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Now take a look using <strong><em>readelf</em></strong> command to get all sections name:</p>

<p><a href="/assets/images/felf/text_patch.png" class="popup img-link "><img data-src="/assets/images/felf/text_patch.png" alt="" class="lazyload" data-proofer-ignore></a></p>

<p>The program still works because the new name is following all the elf specs, and it’s a valid one.</p>

<h1 id="enter-felf">Enter felf</h1>

<p>Now let’s start the real reason of this article, let’s talk about <a href="https://github.com/AandersonL/felf">felf</a>.</p>

<h2 id="why-felf"><span class="mr-2">Why felf</span><a href="#why-felf" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>A couple months, I wanted to build a simple program that extract section hashs of a bunch of elf files, I also wanted to write that in C++ because it’s a languange that I enjoy, and I want to write everything from <strong><em>scratch</em></strong> without any helper library.</p>

<p>My project didn’t worked the way I wanted and I just abandoned it, but I developed new cool library in C++ to work with elf files, that’s the story.</p>

<p>The name <strong><em>Felf</em></strong> came from the <a href="https://nasm.us/">nasm</a> command parameters, if you will want to build a elf file from a nasm file, you pass the paremeter <strong><em>-f</em></strong> with value <strong><em>elf</em></strong>, almost everyone use that two together so the whole command become <strong><em>nasm -felf…</em></strong></p>

<h2 id="installing"><span class="mr-2">Installing</span><a href="#installing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p><a href="https://github.com/buzzer-re/felf">Felf</a> is written in C++ using cmake, so in order to install you will need any modern cpp compiler (g++, llvm…) and of course, <strong><em>cmake</em></strong></p>

<h3 id="automatic-installation"><span class="mr-2">Automatic installation</span><a href="#automatic-installation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>git clone https://github.com/buzzer-re/felf.git
cd felf &amp;&amp; ./install.sh
</pre></td></tr></tbody></table></code></div></div>
<p>The installation script will build for release and install/strip the shared libraries</p>

<h2 id="first-time-using"><span class="mr-2">First time using</span><a href="#first-time-using" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Let’s start by the simplest operation possible, load and print the elf magic number, just like we did before from scratch, in felf this is very simple to perform.</p>

<div class="language-cpp highlighter-rouge"><div class="code-header">
        <span data-label-text="Cpp"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;felf/ELF.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">ELF</span> <span class="n">elf</span><span class="p">(</span><span class="s">"/usr/bin/ip"</span><span class="p">,</span> <span class="n">MAP_RO</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">elf</span><span class="p">.</span><span class="n">valid</span><span class="p">())</span> <span class="p">{</span>
		<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Elf loaded, parsing e_indent value</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
	
		<span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">e_indent</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">elfHeader</span><span class="o">-&gt;</span><span class="n">e_ident</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">EI_NIDENT</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">std</span><span class="o">::</span><span class="n">printf</span><span class="p">(</span><span class="s">"e_indent[%d] = 0x%x(%c)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">e_indent</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">e_indent</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>Compile:</p>

<blockquote>
  <p>g++ -o header_dump header_dump.cpp -lfelf++</p>
</blockquote>

<p>Let’s breakdown this call:</p>

<ul>
  <li>ELF constructor needs the path for the file and the <strong><em>open mode</em></strong></li>
  <li>You also should check if the file is a valid elf file, this is done by a <a href="https://github.com/buzzer-re/felf/blob/master/app/ELF.cpp#L19">magic number test</a></li>
  <li>Almost all internal structures are now mapped inside the ELF object</li>
</ul>

<p>When opening a file, you must tell felf how to map this file in memory, as this is using <a href="https://www.man7.org/linux/man-pages/man2/mmap.2.html">mmap</a> from behind the scenes:</p>

<ul>
  <li>
    <p>MAP_RO: Map the file in Read only mode in memory</p>
  </li>
  <li>
    <p>MAP_RW: Map the file in Read-Write mode in memory, if you want to patch the file 
somehow, this will reflect directly in the file.</p>
  </li>
  <li>
    <p>MAP_EX: Map the file in Read-Execute mode in memory</p>
  </li>
</ul>

<p>Please refer to the <a href="https://github.com/buzzer-re/felf/#the-structures">structures</a> section in the README file, this will show all the structures that are currently supported/mapped.</p>

<h2 id="cool-usages"><span class="mr-2">Cool usages</span><a href="#cool-usages" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="symbol-and-section-dump"><span class="mr-2">Symbol and Section dump</span><a href="#symbol-and-section-dump" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>With this library in mind, we can now do a lot of useful operations quickly using the internal structures, the first one I want to show it’s a simple symbol and section dump using the <a href="https://github.com/AandersonL/felf/#symbol-table">Symbol table</a> and the <a href="https://github.com/buzzer-re/felf/#example-sections">Section table</a> structure.</p>

<div class="language-cpp highlighter-rouge"><div class="code-header">
        <span data-label-text="Cpp"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;felf/ELF.h&gt;</span><span class="cp">
</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
	
	<span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">std</span><span class="o">::</span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"Usage: %s &lt;path_to_elf&gt;</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">ELF</span> <span class="nf">elf</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">MAP_RO</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">elf</span><span class="p">.</span><span class="n">valid</span><span class="p">())</span> <span class="p">{</span>
		
		<span class="n">std</span><span class="o">::</span><span class="n">printf</span><span class="p">(</span><span class="s">"Dumping symbol table with %d symbols</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">elf</span><span class="p">.</span><span class="n">symbolTable</span><span class="p">.</span><span class="n">length</span><span class="p">);</span>
		
		<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">symbolTable</span><span class="p">.</span><span class="n">symbolDataMapped</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">elf</span><span class="p">.</span><span class="n">symbolTable</span><span class="p">.</span><span class="n">symbolDataMapped</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">std</span><span class="o">::</span><span class="n">printf</span><span class="p">(</span><span class="s">"Symbol name: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
		<span class="p">}</span>


		<span class="n">std</span><span class="o">::</span><span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n\n</span><span class="s">Dumping section table with %d symbols</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">elf</span><span class="p">.</span><span class="n">elfSection</span><span class="p">.</span><span class="n">length</span><span class="p">);</span>
		
		<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">elfSection</span><span class="p">.</span><span class="n">sectionsMapped</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">elf</span><span class="p">.</span><span class="n">elfSection</span><span class="p">.</span><span class="n">sectionsMapped</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">std</span><span class="o">::</span><span class="n">printf</span><span class="p">(</span><span class="s">"Section name: %s at "</span><span class="p">,</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
			<span class="n">std</span><span class="o">::</span><span class="n">printf</span><span class="p">(</span><span class="s">"0x%x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="o">-&gt;</span><span class="n">sh_offset</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="err">'</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The above code takes a input elf file, map into memory in read-only mode and parse all the elf structures, the internal variable <a href="https://github.com/AandersonL/felf#symbol-table">symbolTable</a> it’s a good example of why I created this library, you can access the <a href="https://www.cplusplus.com/reference/unordered_map/unordered_map/">unordered_map</a>, that is a C++ implementation of a hashtable without order, and that holds all the symbols names as key and the <strong><em>SymbolData</em></strong> structure as value, this means that if you can quick lookup any of symbol in the file you can just use the <strong><em>find</em></strong>.</p>

<p>Output:</p>

<p><a href="/assets/images/felf/sections_names.png" class="popup img-link "><img data-src="/assets/images/felf/sections_names.png" alt="" class="lazyload" data-proofer-ignore></a></p>

<h3 id="symbol-dumping"><span class="mr-2">Symbol dumping</span><a href="#symbol-dumping" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Using the same idea above, in the next example I will dump the raw data of the <strong><em>main</em></strong>, if the binary isn’t stripped, and pipe that out to radare2.</p>

<div class="language-cpp highlighter-rouge"><div class="code-header">
        <span data-label-text="Cpp"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="k">auto</span> <span class="n">symbolIter</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">symbolTable</span><span class="p">.</span><span class="n">symbolDataMapped</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"main"</span><span class="p">);</span>


<span class="k">if</span> <span class="p">(</span><span class="n">symbolIter</span> <span class="o">!=</span> <span class="n">elf</span><span class="p">.</span><span class="n">symbolTable</span><span class="p">.</span><span class="n">symbolDataMapped</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// Found</span>
    
    <span class="c1">// Loop in SymbolData structure raw data</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">symbolIter</span><span class="o">-&gt;</span><span class="n">second</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">printf</span><span class="p">(</span><span class="s">"%c"</span><span class="p">,</span> <span class="n">symbolIter</span><span class="o">-&gt;</span><span class="n">second</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></td></tr></tbody></table></code></div></div>

<p>Ignoring all the code that load and check the file, the code above it’s pretty straight forward, make a quick lookup at the symbolData map, and extract the raw data of this symbol to the stdout, with that I will pipe that out to <a href="https://github.com/radareorg/radare2">radare2</a> framework and disassemble all (print disassembly all aka pdf).</p>

<p><a href="/assets/images/felf/dump_main_to_r2.png" class="popup img-link "><img data-src="/assets/images/felf/dump_main_to_r2.png" alt="" class="lazyload" data-proofer-ignore></a></p>

<p>Very cool, right?</p>

<h3 id="elf-disassembly"><span class="mr-2">Elf disassembly</span><a href="#elf-disassembly" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Now that we fully understand the power of this simple library, let’s build something cool from scratch, a ELF disassembler, for this we will need to write our asm parser or use a already created library for that, I will use the <a href="https://github.com/aquynh/capstone">Capstone engine</a> to perform that for us, so go grab that before continue (if you are trying the examples above), and take a look at a simple <a href="https://www.capstone-engine.org/lang_c.html">example</a> using this engine.</p>

<p>In order to disassemble something, we must get the valid instructions that contains the <strong><em>opcodes</em></strong>, opcode are just a byte that has a meaning in the CPU, and the readable value of this opcode is called <strong><em>mnemonic</em></strong>, so the opcode <strong><em>0x55</em></strong>  has the mnemonic <strong><em>push</em></strong> and the operators <strong><em>xbp</em></strong> where <strong><em>x</em></strong> differ based in the arch of the CPU, in x64 it’s <strong><em>rbp</em></strong> and x86 <strong><em>ebp</em></strong>, in order words, if one executable section of our memory contains any raw byte and the Instruction pointer are pointing to that area, our CPU will read this instructions and execute that.</p>

<p>For the sake of simplicity, I will disassembly the <strong><em>.text</em></strong> section of a elf file, I will use the sectionTable map to extract the raw data of this section and use the capstone engine to disassembly that.</p>

<h4 id="the-section-data"><span class="mr-2">The section data</span><a href="#the-section-data" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>To get the section data you just need to use the internal variable elfSection and extract the length and their raw data:</p>

<div class="language-cpp highlighter-rouge"><div class="code-header">
        <span data-label-text="Cpp"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Loading .text data...</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="k">auto</span> <span class="n">sectionIter</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">elfSection</span><span class="p">.</span><span class="n">sectionData</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">".text"</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">sectionIter</span> <span class="o">!=</span> <span class="n">elf</span><span class="p">.</span><span class="n">elfSection</span><span class="p">.</span><span class="n">sectionData</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">sectionData</span> <span class="o">=</span> <span class="n">sectionIter</span><span class="o">-&gt;</span><span class="n">second</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>	
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Starting Capstone engine...</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n\n</span><span class="s">Section .text:</span><span class="se">\n\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">capstone_disas</span><span class="p">(</span><span class="n">sectionData</span><span class="p">,</span> <span class="n">sectionIter</span><span class="o">-&gt;</span><span class="n">second</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">);</span>

<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>And the capstone_disas function is written as:</p>

<div class="language-cpp highlighter-rouge"><div class="code-header">
        <span data-label-text="Cpp"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">capstone_disas</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">csh</span> <span class="n">handle</span><span class="p">;</span>
	<span class="n">cs_insn</span><span class="o">*</span> <span class="n">insn</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">codeCount</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">cs_open</span><span class="p">(</span><span class="n">CS_ARCH_X86</span><span class="p">,</span> <span class="n">CS_MODE_64</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">handle</span><span class="p">)</span> <span class="o">!=</span> <span class="n">CS_ERR_OK</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"Error when starting capstone!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">codeCount</span> <span class="o">=</span> <span class="n">cs_disasm</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">insn</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">codeCount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="n">j</span><span class="p">;</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">codeCount</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">std</span><span class="o">::</span>	<span class="n">printf</span><span class="p">(</span><span class="s">"0x%"</span><span class="n">PRIx64</span><span class="s">":</span><span class="se">\t</span><span class="s">%s</span><span class="se">\t\t</span><span class="s">%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">insn</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">address</span><span class="p">,</span> <span class="n">insn</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">mnemonic</span><span class="p">,</span> <span class="n">insn</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">op_str</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">cs_free</span><span class="p">(</span><span class="n">insn</span><span class="p">,</span> <span class="n">codeCount</span><span class="p">);</span>
		
	<span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>This function, starts the capstone engine in x86 architecture and in x64 mode, then we just send the whole data that we want to disassemble and the <strong><em>cs_insn</em></strong> struct pointer, that holds information like the mnemonic value and operators values.</p>

<p>Compile:</p>

<blockquote>
  <p>g++ -o text_disas text_disas.cpp -lfelf++ -lcapstone</p>
</blockquote>

<p>Run:</p>

<p><a href="/assets/images/felf/elf_disas.png" class="popup img-link "><img data-src="/assets/images/felf/elf_disas.png" alt="" class="lazyload" data-proofer-ignore></a></p>

<p>Ready to build your own reverse engineering tools ?</p>

<h1 id="conclusion">Conclusion</h1>

<p>You see that this tiny and little x64 elf parser can do, and it’s has a very simple code to parse everything in C++ structures, I hope that this article helped you to understand more about the ELF format and executable formats in general.</p>

<p>This project has a lot potential to grow up, and I have a lot ideas like: Python and Golang bindings, Code refactoring and more support for different architectures.</p>

<p>Thanks for reading all this, and if this article has any mistake, fell free to open a issue in the felf project and I will fix.</p>

<p>Revision by: <a href="https://github.com/jvlsg">@jvslg</a></p>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  
  <div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i>
    
      <a href='/categories/programming/'>Programming</a>
  </div>
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i>
      
      <a href="/tags/programming/"
          class="post-tag no-text-decoration" >Programming</a>
      
      <a href="/tags/reverse-engineering/"
          class="post-tag no-text-decoration" >Reverse engineering</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.

      
    </div>

    <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=Manipulating%20elf%20files%20in%20C++%20using%20felf%20-%20Reversing%20codes&url=https%3A%2F%2Freversing.codes%2Fposts%2FManipulating-elf-with-felf%2F" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=Manipulating%20elf%20files%20in%20C++%20using%20felf%20-%20Reversing%20codes&u=https%3A%2F%2Freversing.codes%2Fposts%2FManipulating-elf-with-felf%2F" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://t.me/share/url?url=https%3A%2F%2Freversing.codes%2Fposts%2FManipulating-elf-with-felf%2F&text=Manipulating%20elf%20files%20in%20C++%20using%20felf%20-%20Reversing%20codes" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="Copy link"
        data-title-succeed="Link copied successfully!">
    </i>

  </span>
</div>


  </div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->


      
    
    

    </div>
  </div> <!-- #core-wrapper -->

  <!-- panel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted">

    <div class="access">
      















  <div id="access-lastmod" class="post">
    <div class="panel-heading">Recently Updated</div>
    <ul class="post-content pl-0 pb-1 ml-1 mt-2">
      
        
        
        
      <li><a href="/posts/PlayStation-5-ELF-Injection/">Usermode ELF injection on the PlayStation 5</a></li>
      
        
        
        
      <li><a href="/posts/ps4-kernel-patching-guide/">How to patch the running PlayStation 4 kernel</a></li>
      
        
        
        
      <li><a href="/posts/Stop-Using-GetProcAddress-And-Let-The-Linker/">Quick Tip: Stop Using GetProcAddress and Let the Linker Do the Job for You</a></li>
      
        
        
        
      <li><a href="/posts/Manual-unpacking-in-details/">Manual Unpacking in Details</a></li>
      
        
        
        
      <li><a href="/posts/Manipulating-elf-with-felf/">Manipulating elf files in C++ using felf</a></li>
      
    </ul>
  </div> <!-- #access-lastmod -->



      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/programming/">Programming</a>
    
      
      <a class="post-tag" href="/tags/reverse-engineering/">Reverse engineering</a>
    
      
      <a class="post-tag" href="/tags/malware-research/">Malware Research</a>
    
      
      <a class="post-tag" href="/tags/ctf/">ctf</a>
    
      
      <a class="post-tag" href="/tags/windows-internals/">Windows Internals</a>
    
      
      <a class="post-tag" href="/tags/freebsd/">FreeBSD</a>
    
      
      <a class="post-tag" href="/tags/malware-analysis/">Malware analysis</a>
    
      
      <a class="post-tag" href="/tags/malware-research/">Malware research</a>
    
      
      <a class="post-tag" href="/tags/network-analysis/">Network analysis</a>
    
      
      <a class="post-tag" href="/tags/obfuscation-analysis/">obfuscation analysis</a>
    

    </div>
  </div>


    </div>

    
      
      



  <div id="toc-wrapper" class="pl-0 pr-4 mb-5">
    <div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
    <nav id="toc"></nav>
  </div>

  <!-- toc.js will be loaded at medium priority -->
  <script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script>


    
  </div>

</div>

<!-- tail -->

<div class="row">
  <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5">
    
      
      <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->





  <div id="related-posts" class="mb-2 mb-sm-4">
    <h3 class="pt-2 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/Code-it-flare-7/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1603495416"
    data-df="ll"
    >
  Oct 23, 2020
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>The Flare 7th AutoIT challenge</h3>
            <div class="text-muted small">
              <p>
                





                The 7th challenge of Flare-On CTF, give to us a QR code generator software that are fully obfuscated, the fun part of this challenge was interpret, analyse and deobfuscate core components of the so...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/VBA-Stomping-flare/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1603495416"
    data-df="ll"
    >
  Oct 23, 2020
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>VBA Stomping: The macro hidden in plain sight</h3>
            <div class="text-muted small">
              <p>
                





                At Flare-on 7th there was a very interesting malware analysis challenge that envolved a very unique hide technique for malicious Macros. This technique is called VBA Stomp, this works by hiding the...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/Retrieving-the-exfiltrated-flag-flareon7/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1603495536"
    data-df="ll"
    >
  Oct 23, 2020
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Data exfiltration: From shellcode to flag</h3>
            <div class="text-muted small">
              <p>
                





                At Flare 7th edition, my favorite challenge was re_crowd, this challenge was really close to a very real world scenario, with just an pcap we are able to understand how the company was attacked, wh...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->


    
      
      <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/Retrieving-the-exfiltrated-flag-flareon7/" class="btn btn-outline-primary"
    prompt="Older">
    <p>Data exfiltration: From shellcode to flag</p>
  </a>
  

  
  <a href="/posts/Manual-unpacking-in-details/" class="btn btn-outline-primary"
    prompt="Newer">
    <p>Manual Unpacking in Details</p>
  </a>
  

</div>

    
      
      <!--  The comments switcher -->


    
  </div>
</div>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/programming/">Programming</a>
    
      
      <a class="post-tag" href="/tags/reverse-engineering/">Reverse engineering</a>
    
      
      <a class="post-tag" href="/tags/malware-research/">Malware Research</a>
    
      
      <a class="post-tag" href="/tags/ctf/">ctf</a>
    
      
      <a class="post-tag" href="/tags/windows-internals/">Windows Internals</a>
    
      
      <a class="post-tag" href="/tags/freebsd/">FreeBSD</a>
    
      
      <a class="post-tag" href="/tags/malware-analysis/">Malware analysis</a>
    
      
      <a class="post-tag" href="/tags/malware-research/">Malware research</a>
    
      
      <a class="post-tag" href="/tags/network-analysis/">Network analysis</a>
    
      
      <a class="post-tag" href="/tags/obfuscation-analysis/">obfuscation analysis</a>
    

    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    <!-- The Footer -->

<footer>
  <div class="container pl-lg-4 pr-lg-4">
    <div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3">
      <div class="footer-left">
        <p class="mb-0">
          © 2025
          <a href="https://github.com/buzzer-re">Buzzer</a>.
          
          <span data-toggle="tooltip" data-placement="top"
            title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
          
        </p>
      </div>

      <div class="footer-right">
        <p class="mb-0">Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>.
        </p>
      </div>
    </div>
  </div>
</footer>


    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    
      <div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true"
        data-animation="true" data-autohide="false">
        <div class="toast-header">
          <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="toast-body text-center pt-0">
          <p class="pl-2 pr-2 mb-3">A new version of content is available.</p>
          <button type="button" class="btn btn-primary" aria-label="Update">
            Update
          </button>
        </div>
      </div>
    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No results found.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!-- JS selector for site. -->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup & clipboard -->
  

  







  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js"></script>





  

  

  







  
    

    

  



  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1.11.6/dayjs.min.js,npm/dayjs@1.11.6/locale/en.min.js,npm/dayjs@1.11.6/plugin/relativeTime.min.js,npm/dayjs@1.11.6/plugin/localizedFormat.min.js"></script>







<script defer src="/assets/js/dist/post.min.js"></script>



<!-- commons -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>




  </body>

</html>

